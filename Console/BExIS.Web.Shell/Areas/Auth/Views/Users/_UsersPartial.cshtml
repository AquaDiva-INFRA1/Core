@using Telerik.Web.Mvc.UI
@using BExIS.Web.Shell.Areas.Auth.Models;

@model List<UserModel>

@(Html.Telerik().Grid(Model)
        .Name("Grid_Users")
        .DataKeys(keys =>
        {
            keys.Add(u => u.Id);
        })
        .ToolBar(command =>
            {
                command.Custom().Name("Create").Text("New User").Ajax(true).ButtonType(GridButtonType.ImageAndText).ImageHtmlAttributes(new { @class = "t-icon t-add" });
            })
        .Columns(columns =>
        {
            columns.Command(command =>
            {
                command.Custom("Details").Ajax(true).ButtonType(GridButtonType.BareImage).ImageHtmlAttributes(new { @class = "t-icon t-edit" });
                command.Custom("Delete").Ajax(true).ButtonType(GridButtonType.BareImage).ImageHtmlAttributes(new { @class = "t-icon t-delete" });
            }).Title("Actions").Width(90).HtmlAttributes(new { style = "text-align:left" });
            columns.Bound(u => u.Id).Width(100);
            columns.Bound(u => u.UserName).Width(250);
            columns.Bound(u => u.Email);
            columns.Bound(u => u.Comment);
        })
        .ClientEvents(clientEvents => clientEvents.OnCommand("onCommand"))
        .DataBinding(dataBinding => dataBinding
                .Ajax()
                .Select("Users_Select", "Users")
        )
        .Filterable()
        .Sortable(sortable => sortable
            .OrderBy(orderby => orderby
                .Add(r => r.Id).Descending()))
        .Scrollable(scrollable => scrollable.Height(500))
)

<div id="Window_UserCreation" title="User Creation" />

<div id="Window_UserDeletion" title="User Deletion" />

<div id="Window_UserDetails" title="User Details" />

<script type="text/javascript">
    
    function onCommand(e) {

        if (e.name == "Create") {
            $('#Window_UserCreation').load('@Url.Action("Create", "Users")',
                function () {
                    $('#Window_UserCreation').dialog({
                        autoOpen: true,
                        modal: true,
                        width: "auto",
                        height: "auto",
                        resizable: false,
                        close: function () {
                            $('#Window_UserCreation').html("");
                        }
                    });
                }
            );
        }

        if (e.name == "Delete") {
            var userID = e.dataItem.Id;

            $.get('@Url.Action("Delete", "Users")', { Id: userID },
                function (data) {
                    $('#Window_UserDeletion').html(data);
                    $('#Window_UserDeletion').dialog({
                        autoOpen: true,
                        modal: true,
                        width: "auto",
                        height: "auto",
                        resizable: false,
                        close: function () {
                            $('#Window_UserDeletion').html("");
                        }
                    });
                }
            );
        }

        if (e.name == "Details") {
            var userID = e.dataItem.Id;

            $.get('@Url.Action("Details", "Users")', { Id: userID },
                function (data) {
                    $('#Window_UserDetails').html(data);
                }
            );

            $.get('@Url.Action("UserInfo", "Users")', { Id: userID },
                function (data) {
                    $('#Tabstrip_UserInfo').html(data);
                    $('#Window_UserDetails').dialog({
                        autoOpen: true,
                        modal: true,
                        width: "auto",
                        height: "auto",
                        resizable: false,
                        close: function () {
                            $('#Window_UserDetails').html("");
                        }
                    });
                }
            );
        }
    }

    function cancelUserEdit(e) {
        $.get('@Url.Action("UserInfo", "Users")', { Id: e }, function (data) {
            $('#Window_UserInfo').html(data);
        });
    }

    function editUserInfo(e) {
        $.get('@Url.Action("UserEdit", "Users")', { Id: e }, function (data) {
            $('#Window_UserInfo').html(data);
        });
    }

</script>