@using Telerik.Web.Mvc.UI
@using BExIS.Web.Shell.Areas.Auth.Models;

@model IEnumerable<FeatureModel>

@(Html.Telerik().TreeView()
        .Name("TreeView_Features")
        .BindTo(Model, mappings =>
        {
            mappings.For<FeatureModel>(binding => binding
                .ItemDataBound((item, feature) =>
                {
                    item.Text = feature.FeatureName;
                    item.Value = feature.Id.ToString();
                })
                .Children(feature => feature.Children));
        })
        .ClientEvents(events => events
            .OnSelect("OnSelect")
        )
        .ExpandAll(true)
)

<script type="text/javascript">

    function GetTreeView() {
        return $('#TreeView_Features').data('tTreeView');
    }

    function OnSelect(e) {
        var featureID = GetTreeView().getItemValue(e.item);
        
        $('#Content_Subjects').empty();

        $.get('@Url.Action("FeaturePermissions", "Permissions")', { Id: featureID }, function (contentData) {

            $('#Content_Subjects').html(contentData);
        });
    }

    // Feature Permission
    function setFeaturePermission(value, subjectId, featureId) {
        if (value) {
            $.post('@Url.Action("CreateFeaturePermission", "Permissions")', { FeatureId: featureId, SubjectId: subjectId }, function (e) {
                if (e == 2) {
                    alert("The subject does not exist anymore.");
                }

                if (e == 3) {
                    alert("The feature does not exist anymore.");
                }

                $("#Grid_Subjects .t-refresh").trigger('click');
            });
        }
        else {
            $.post('@Url.Action("DeleteFeaturePermission", "Permissions")', { FeatureId: featureId, SubjectId: subjectId }, function (e) {
                if (e == 2) {
                    alert("The subject does not exist anymore.");
                }

                if (e == 3) {
                    alert("The feature does not exist anymore.");
                }

                $("#Grid_Subjects .t-refresh").trigger('click');
            });
        }
    }

</script>