import{S as wt,i as $t,f as $e,c as j,a as z,m as G,t as I,g as Qe,b as S,e as We,h as vt,d as Y}from"../chunks/index.DYURmr33.js";import{F as ut,c as gl,d as tl,g as kt,a as Ve,l as pl,e as Xe,m as ml,o as ll,P as _l,p as hl}from"../chunks/eslint4b.es.BLUuBmqK.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.CX43xlbX.js";import{s as yt,F as ye,e as w,j as R,c as $,b as T,d as v,l as P,a as p,i as se,m as u,v as O,G as Ee,q as rl,w as At,I as nl,H as bl,g as we,n as st,f as Ce,J as vl,D as kl,t as at,k as ot,z as wl,o as it,h as Dt,r as ce}from"../chunks/scheduler.CYFbRwgw.js";import{S as Lt,h as $l,u as yl,E as El}from"../chunks/ErrorMessage.M_oOSnJZ.js";import{A as Cl,V as Il,a as Tl,d as Sl}from"../chunks/help.BVYKNYvG.js";import{e as sl,i as Vl,a as Dl,s as Al,c as Ll,b as Ml,d as Bl}from"../chunks/types.B8wc0Djk.js";import{d as Nl,e as Rl,l as al,f as Pl,h as Ul,a as Ol,b as ql,i as Hl}from"../chunks/services.CkTcXgKw.js";import{g as Vt}from"../chunks/BaseCaller.CX6_4FGJ.js";import{D as bt}from"../chunks/DropdownKvP.DPdz7_T_.js";import{M as Kl}from"../chunks/MissingValues.D7KPXHEU.js";function Fl(){return{}}const $r=Object.freeze(Object.defineProperty({__proto__:null,load:Fl},Symbol.toStringTag,{value:"Module"}));function Yt(e){let t,r;return t=new Tl({props:{message:"please select a primary key",cssClass:"variant-filled-warning"}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){S(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function jl(e){let t,r,l,n,a,o,c,s,d,k,f,g,y,E,V,M,B,N,C,ee,H,K,de;a=new ut({props:{icon:gl}}),d=new ut({props:{icon:tl}});function ge(_){e[11](_)}let J={model:e[0]};e[2]!==void 0&&(J.valid=e[2]),y=new Cl({props:J}),ye.push(()=>$e(y,"valid",ge));let L=e[4]&&e[0].variables.length>0&&!e[3]&&Yt();function be(_){e[12](_)}function te(_){e[13](_)}function pe(_){e[14](_)}let ae={data:e[6]()};return e[0].variables!==void 0&&(ae.variables=e[0].variables),e[1]!==void 0&&(ae.valid=e[1]),e[0].missingValues!==void 0&&(ae.missingValues=e[0].missingValues),B=new Il({props:ae}),ye.push(()=>$e(B,"variables",be)),ye.push(()=>$e(B,"valid",te)),ye.push(()=>$e(B,"missingValues",pe)),{c(){t=w("div"),r=w("div"),l=w("div"),n=w("button"),j(a.$$.fragment),o=R(),c=w("div"),s=w("button"),j(d.$$.fragment),g=R(),j(y.$$.fragment),V=R(),L&&L.c(),M=R(),j(B.$$.fragment),this.h()},l(_){t=$(_,"DIV",{});var q=T(t);r=$(q,"DIV",{class:!0});var ne=T(r);l=$(ne,"DIV",{class:!0});var F=T(l);n=$(F,"BUTTON",{id:!0,title:!0,class:!0});var oe=T(n);z(a.$$.fragment,oe),oe.forEach(v),F.forEach(v),o=P(ne),c=$(ne,"DIV",{class:!0});var De=T(c);s=$(De,"BUTTON",{id:!0,title:!0,class:!0});var ie=T(s);z(d.$$.fragment,ie),ie.forEach(v),De.forEach(v),ne.forEach(v),g=P(q),z(y.$$.fragment,q),V=P(q),L&&L.l(q),M=P(q),z(B.$$.fragment,q),q.forEach(v),this.h()},h(){p(n,"id","back"),p(n,"title","back"),p(n,"class","btn variant-filled-warning"),p(l,"class","grow"),p(s,"id","save"),p(s,"title","save"),p(s,"class","btn variant-filled-primary text-xl"),s.disabled=k=!e[1]||!e[2]||!(e[4]&&e[3]||!e[4]),p(c,"class","flex-none text-end"),p(r,"class","flex")},m(_,q){se(_,t,q),u(t,r),u(r,l),u(l,n),G(a,n,null),u(r,o),u(r,c),u(c,s),G(d,s,null),u(t,g),G(y,t,null),u(t,V),L&&L.m(t,null),u(t,M),G(B,t,null),H=!0,K||(de=[O(n,"mouseover",e[8]),O(n,"click",e[9]),O(s,"mouseover",e[10]),O(s,"click",e[5])],K=!0)},p(_,[q]){(!H||q&14&&k!==(k=!_[1]||!_[2]||!(_[4]&&_[3]||!_[4])))&&(s.disabled=k);const ne={};q&1&&(ne.model=_[0]),!E&&q&4&&(E=!0,ne.valid=_[2],Ee(()=>E=!1)),y.$set(ne),_[4]&&_[0].variables.length>0&&!_[3]?L?q&9&&I(L,1):(L=Yt(),L.c(),I(L,1),L.m(t,M)):L&&(Qe(),S(L,1,1,()=>{L=null}),We());const F={};!N&&q&1&&(N=!0,F.variables=_[0].variables,Ee(()=>N=!1)),!C&&q&2&&(C=!0,F.valid=_[1],Ee(()=>C=!1)),!ee&&q&1&&(ee=!0,F.missingValues=_[0].missingValues,Ee(()=>ee=!1)),B.$set(F)},i(_){H||(I(a.$$.fragment,_),I(d.$$.fragment,_),_&&rl(()=>{H&&(f||(f=vt(r,kt,{},!0)),f.run(1))}),I(y.$$.fragment,_),I(L),I(B.$$.fragment,_),H=!0)},o(_){S(a.$$.fragment,_),S(d.$$.fragment,_),_&&(f||(f=vt(r,kt,{},!1)),f.run(0)),S(y.$$.fragment,_),S(L),S(B.$$.fragment,_),H=!1},d(_){_&&v(t),Y(a),Y(d),_&&f&&f.end(),Y(y),L&&L.d(),Y(B),K=!1,At(de)}}}function zl(e,t,r){let l,n=!1,a=!1;nl();let{model:o}=t,c=bl(sl);function s(){var ee;let C=!1;(ee=o.variables)==null||ee.forEach(H=>{H.isKey==!0&&(C=!0)}),r(3,l=C)}async function d(){const C=await Nl(o);console.log("save",C),o.entityId>0?Vt("/dcm/edit?id="+o.entityId):Vt("/rpm/datastructure")}function k(){let C=[];if(o&&o.markers){const ee=o.markers.find(H=>H.type=="data");if(ee)for(let H=ee.row;H<o.preview.length;H++){const K=o.preview[H];C.push(K.split(String.fromCharCode(o.delimeter)))}}return C}function f(){Vt(document.referrer)}const g=()=>Ve.show("back"),y=()=>f(),E=()=>Ve.show("save");function V(C){a=C,r(2,a)}function M(C){e.$$.not_equal(o.variables,C)&&(o.variables=C,r(0,o))}function B(C){n=C,r(1,n)}function N(C){e.$$.not_equal(o.missingValues,C)&&(o.missingValues=C,r(0,o))}return e.$$set=C=>{"model"in C&&r(0,o=C.model)},e.$$.update=()=>{e.$$.dirty&1&&s()},r(3,l=!1),[o,n,a,l,c,d,k,f,g,y,E,V,M,B,N]}class Gl extends wt{constructor(t){super(),$t(this,t,zl,jl,yt,{model:0})}}function Yl(e){let t,r='<h4 class="h4">Controls</h4> <hr class="divide-x-8"/> <dl class="list-dl gap-0"><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Selection</dt> <dd>left mouse button</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Drag</dt> <dd>left mouse button down and drag</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Deselect</dt> <dd>right mouse button click</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Select Row</dt> <dd>double click left mouse button or click arrow</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Deselect Row</dt> <dd>right mouse button click on arrow</dd></span></div></dl>';return{c(){t=w("div"),t.innerHTML=r,this.h()},l(l){t=$(l,"DIV",{class:!0,"data-svelte-h":!0}),we(t)!=="svelte-1p56ohu"&&(t.innerHTML=r),this.h()},h(){p(t,"class","col-span-1 card p-5 text-sm")},m(l,n){se(l,t,n)},p:st,i:st,o:st,d(l){l&&v(t)}}}class Jl extends wt{constructor(t){super(),$t(this,t,null,Yl,yt,{})}}function Jt(e,t,r){const l=e.slice();return l[56]=t[r],l[58]=r,l}function Xt(e,t,r){const l=e.slice();return l[59]=t[r],l[61]=r,l}function Qt(e,t,r){const l=e.slice();return l[62]=t[r],l}function Xl(e){let t,r,l,n,a,o,c,s,d,k,f,g,y,E,V,M,B,N,C,ee="Variable",H,K,de="Unit",ge,J,L="Description",be,te,pe="Missing Values",ae,_,q="Data",ne,F,oe,De,ie,me,Ze,xe,ve,ke,et,Ae,_e,Ie,je,tt,Le,Te,lt,he,le,Se,Me,ft="Total:",i,b=e[0].total+"",h,X,W,Q,rt="Found:",ze,Be=e[0].total-e[0].skipped+"",ct,Et,Oe,Ge,Mt="Skipped:",Ct,nt=e[0].skipped+"",dt,It,qe,Bt="<i>you see only the first 10 rows of the data</i>",Tt,He,Ye,Ne,St,Nt;function ol(m){e[19](m)}let Rt={id:"delimeter",title:"Delimeter",source:e[0].delimeters,complexTarget:!1,help:!0};e[0].delimeter!==void 0&&(Rt.target=e[0].delimeter),o=new bt({props:Rt}),ye.push(()=>$e(o,"target",ol)),o.$on("change",e[15]);function il(m){e[20](m)}let Pt={id:"decimal",title:"Decimal",source:e[0].decimals,complexTarget:!1,help:!0};e[0].decimal!==void 0&&(Pt.target=e[0].decimal),d=new bt({props:Pt}),ye.push(()=>$e(d,"target",il));function ul(m){e[21](m)}let Ut={id:"textMarker",title:"TextMarker",source:e[0].textMarkers,complexTarget:!1,help:!0};e[0].textMarker!==void 0&&(Ut.target=e[0].textMarker),g=new bt({props:Ut}),ye.push(()=>$e(g,"target",ul));function fl(m){e[22](m)}let Ot={id:"encoding",title:"Encoding",source:e[0].encodings,complexTarget:!1,help:!0};e[0].fileEncoding!==void 0&&(Ot.target=e[0].fileEncoding),V=new bt({props:Ot}),ye.push(()=>$e(V,"target",fl)),V.$on("change",function(){kl(e[17](e[0].fileEncoding))&&e[17](e[0].fileEncoding).apply(this,arguments)}),oe=new ut({props:{icon:pl}});function cl(m){e[34](m)}let qt={};e[0].missingValues!==void 0&&(qt.list=e[0].missingValues),me=new Kl({props:qt}),ye.push(()=>$e(me,"list",cl));let Je=Xe(e[2]),x=[];for(let m=0;m<Je.length;m+=1)x[m]=Wt(Qt(e,Je,m));Ie=new ut({props:{icon:tl}}),Te=new Jl({});let Ke=Xe(e[0].preview),U=[];for(let m=0;m<Ke.length;m+=1)U[m]=xt(Jt(e,Ke,m));const dl=m=>S(U[m],1,1,()=>{U[m]=null});return{c(){t=w("form"),r=w("div"),l=w("div"),n=w("div"),a=w("div"),j(o.$$.fragment),s=R(),j(d.$$.fragment),f=R(),j(g.$$.fragment),E=R(),j(V.$$.fragment),B=R(),N=w("div"),C=w("button"),C.textContent=ee,H=R(),K=w("button"),K.textContent=de,ge=R(),J=w("button"),J.textContent=L,be=R(),te=w("button"),te.textContent=pe,ae=R(),_=w("button"),_.textContent=q,ne=R(),F=w("button"),j(oe.$$.fragment),De=R(),ie=w("div"),j(me.$$.fragment),xe=R(),ve=w("div"),ke=w("div");for(let m=0;m<x.length;m+=1)x[m].c();et=R(),Ae=w("div"),_e=w("button"),j(Ie.$$.fragment),tt=R(),Le=w("div"),j(Te.$$.fragment),lt=R(),he=w("div"),le=w("div"),Se=w("label"),Me=w("b"),Me.textContent=ft,i=R(),h=at(b),X=R(),W=w("label"),Q=w("b"),Q.textContent=rt,ze=R(),ct=at(Be),Et=R(),Oe=w("label"),Ge=w("b"),Ge.textContent=Mt,Ct=R(),dt=at(nt),It=R(),qe=w("label"),qe.innerHTML=Bt,Tt=R(),He=w("table"),Ye=w("tbody");for(let m=0;m<U.length;m+=1)U[m].c();this.h()},l(m){t=$(m,"FORM",{});var A=T(t);r=$(A,"DIV",{id:!0,class:!0});var Z=T(r);l=$(Z,"DIV",{class:!0});var Re=T(l);n=$(Re,"DIV",{id:!0,class:!0});var ue=T(n);a=$(ue,"DIV",{id:!0,class:!0});var fe=T(a);z(o.$$.fragment,fe),s=P(fe),z(d.$$.fragment,fe),f=P(fe),z(g.$$.fragment,fe),E=P(fe),z(V.$$.fragment,fe),fe.forEach(v),B=P(ue),N=$(ue,"DIV",{id:!0,class:!0});var re=T(N);C=$(re,"BUTTON",{class:!0,id:!0,type:!0,"data-svelte-h":!0}),we(C)!=="svelte-1vcmr03"&&(C.textContent=ee),H=P(re),K=$(re,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),we(K)!=="svelte-1uhcbun"&&(K.textContent=de),ge=P(re),J=$(re,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),we(J)!=="svelte-1cfm3l4"&&(J.textContent=L),be=P(re),te=$(re,"BUTTON",{class:!0,type:!0,color:!0,id:!0,"data-svelte-h":!0}),we(te)!=="svelte-1v4zuqe"&&(te.textContent=pe),ae=P(re),_=$(re,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),we(_)!=="svelte-pjfsfy"&&(_.textContent=q),ne=P(re),F=$(re,"BUTTON",{title:!0,id:!0,class:!0,type:!0});var D=T(F);z(oe.$$.fragment,D),D.forEach(v),re.forEach(v),De=P(ue),ie=$(ue,"DIV",{id:!0,class:!0});var Pe=T(ie);z(me.$$.fragment,Pe),Pe.forEach(v),xe=P(ue),ve=$(ue,"DIV",{class:!0});var gt=T(ve);ke=$(gt,"DIV",{id:!0,class:!0});var Ht=T(ke);for(let Fe=0;Fe<x.length;Fe+=1)x[Fe].l(Ht);Ht.forEach(v),et=P(gt),Ae=$(gt,"DIV",{class:!0});var Kt=T(Ae);_e=$(Kt,"BUTTON",{title:!0,class:!0});var Ft=T(_e);z(Ie.$$.fragment,Ft),Ft.forEach(v),Kt.forEach(v),gt.forEach(v),ue.forEach(v),tt=P(Re),Le=$(Re,"DIV",{class:!0});var jt=T(Le);z(Te.$$.fragment,jt),jt.forEach(v),Re.forEach(v),lt=P(Z),he=$(Z,"DIV",{id:!0,class:!0});var pt=T(he);le=$(pt,"DIV",{id:!0,class:!0});var Ue=T(le);Se=$(Ue,"LABEL",{});var mt=T(Se);Me=$(mt,"B",{"data-svelte-h":!0}),we(Me)!=="svelte-sykk0o"&&(Me.textContent=ft),i=P(mt),h=ot(mt,b),mt.forEach(v),X=P(Ue),W=$(Ue,"LABEL",{});var _t=T(W);Q=$(_t,"B",{"data-svelte-h":!0}),we(Q)!=="svelte-5ox7e6"&&(Q.textContent=rt),ze=P(_t),ct=ot(_t,Be),_t.forEach(v),Et=P(Ue),Oe=$(Ue,"LABEL",{});var ht=T(Oe);Ge=$(ht,"B",{"data-svelte-h":!0}),we(Ge)!=="svelte-1pbimz2"&&(Ge.textContent=Mt),Ct=P(ht),dt=ot(ht,nt),ht.forEach(v),It=P(Ue),qe=$(Ue,"LABEL",{class:!0,"data-svelte-h":!0}),we(qe)!=="svelte-klacyg"&&(qe.innerHTML=Bt),Ue.forEach(v),Tt=P(pt),He=$(pt,"TABLE",{class:!0});var zt=T(He);Ye=$(zt,"TBODY",{});var Gt=T(Ye);for(let Fe=0;Fe<U.length;Fe+=1)U[Fe].l(Gt);Gt.forEach(v),zt.forEach(v),pt.forEach(v),Z.forEach(v),A.forEach(v),this.h()},h(){p(a,"id","reader selections"),p(a,"class","flex flex-none gap-2"),p(C,"class","btn variant-filled-error"),p(C,"id","selectVar"),p(C,"type","button"),p(K,"class","btn variant-filled-success"),p(K,"type","button"),p(K,"id","selectUnit"),p(J,"class","btn variant-filled-warning"),p(J,"type","button"),p(J,"id","selectDescription"),p(te,"class","btn variant-filled-secondary"),p(te,"type","button"),p(te,"color","info"),p(te,"id","selectMissingValues"),p(_,"class","btn variant-filled-primary"),p(_,"type","button"),p(_,"id","selectData"),p(F,"title","reset selection"),p(F,"id","resetSelection"),p(F,"class","btn variant-filled-warning text-lg"),p(F,"type","button"),p(N,"id","markers"),p(N,"class","py-5 flex gap-1"),p(ie,"id","missingvalues"),p(ie,"class","grow"),p(ke,"id","errors"),p(ke,"class","m-2 text-sm grow text-right"),p(_e,"title","save"),p(_e,"class","btn variant-filled-primary text-lg"),_e.disabled=je=!e[5],p(Ae,"class","text-right"),p(ve,"class","flex"),p(n,"id","edit"),p(n,"class","flex flex-col grow gap-2"),p(Le,"class","controls"),p(l,"class","flex gap-5"),p(qe,"class","grow text-right"),p(le,"id","data infos"),p(le,"class","flex flex-auto gap-5 pb-2"),p(He,"class","table table-compact"),p(he,"id","preview data"),p(he,"class","flex-col py-5"),p(r,"id","structure-suggestion-container"),p(r,"class","flex-col gap-3")},m(m,A){se(m,t,A),u(t,r),u(r,l),u(l,n),u(n,a),G(o,a,null),u(a,s),G(d,a,null),u(a,f),G(g,a,null),u(a,E),G(V,a,null),u(n,B),u(n,N),u(N,C),u(N,H),u(N,K),u(N,ge),u(N,J),u(N,be),u(N,te),u(N,ae),u(N,_),u(N,ne),u(N,F),G(oe,F,null),u(n,De),u(n,ie),G(me,ie,null),u(n,xe),u(n,ve),u(ve,ke);for(let Z=0;Z<x.length;Z+=1)x[Z]&&x[Z].m(ke,null);u(ve,et),u(ve,Ae),u(Ae,_e),G(Ie,_e,null),u(l,tt),u(l,Le),G(Te,Le,null),u(r,lt),u(r,he),u(he,le),u(le,Se),u(Se,Me),u(Se,i),u(Se,h),u(le,X),u(le,W),u(W,Q),u(W,ze),u(W,ct),u(le,Et),u(le,Oe),u(Oe,Ge),u(Oe,Ct),u(Oe,dt),u(le,It),u(le,qe),u(he,Tt),u(he,He),u(He,Ye);for(let Z=0;Z<U.length;Z+=1)U[Z]&&U[Z].m(Ye,null);Ne=!0,St||(Nt=[O(C,"click",e[23]),O(C,"mouseover",e[24]),O(K,"mouseover",e[25]),O(K,"click",e[26]),O(J,"mouseover",e[27]),O(J,"click",e[28]),O(te,"mouseover",e[29]),O(te,"click",e[30]),O(_,"mouseover",e[31]),O(_,"click",e[32]),O(F,"mouseover",e[33]),O(F,"click",e[12]),O(He,"contextmenu",er),O(r,"mousedown",e[7]),O(r,"mouseup",e[8]),O(t,"submit",wl(e[14]))],St=!0)},p(m,A){e=m;const Z={};A[0]&1&&(Z.source=e[0].delimeters),!c&&A[0]&1&&(c=!0,Z.target=e[0].delimeter,Ee(()=>c=!1)),o.$set(Z);const Re={};A[0]&1&&(Re.source=e[0].decimals),!k&&A[0]&1&&(k=!0,Re.target=e[0].decimal,Ee(()=>k=!1)),d.$set(Re);const ue={};A[0]&1&&(ue.source=e[0].textMarkers),!y&&A[0]&1&&(y=!0,ue.target=e[0].textMarker,Ee(()=>y=!1)),g.$set(ue);const fe={};A[0]&1&&(fe.source=e[0].encodings),!M&&A[0]&1&&(M=!0,fe.target=e[0].fileEncoding,Ee(()=>M=!1)),V.$set(fe);const re={};if(!Ze&&A[0]&1&&(Ze=!0,re.list=e[0].missingValues,Ee(()=>Ze=!1)),me.$set(re),A[0]&4){Je=Xe(e[2]);let D;for(D=0;D<Je.length;D+=1){const Pe=Qt(e,Je,D);x[D]?x[D].p(Pe,A):(x[D]=Wt(Pe),x[D].c(),x[D].m(ke,null))}for(;D<x.length;D+=1)x[D].d(1);x.length=Je.length}if((!Ne||A[0]&32&&je!==(je=!e[5]))&&(_e.disabled=je),(!Ne||A[0]&1)&&b!==(b=e[0].total+"")&&it(h,b),(!Ne||A[0]&1)&&Be!==(Be=e[0].total-e[0].skipped+"")&&it(ct,Be),(!Ne||A[0]&1)&&nt!==(nt=e[0].skipped+"")&&it(dt,nt),A[0]&69195){Ke=Xe(e[0].preview);let D;for(D=0;D<Ke.length;D+=1){const Pe=Jt(e,Ke,D);U[D]?(U[D].p(Pe,A),I(U[D],1)):(U[D]=xt(Pe),U[D].c(),I(U[D],1),U[D].m(Ye,null))}for(Qe(),D=Ke.length;D<U.length;D+=1)dl(D);We()}},i(m){if(!Ne){I(o.$$.fragment,m),I(d.$$.fragment,m),I(g.$$.fragment,m),I(V.$$.fragment,m),I(oe.$$.fragment,m),I(me.$$.fragment,m),I(Ie.$$.fragment,m),I(Te.$$.fragment,m);for(let A=0;A<Ke.length;A+=1)I(U[A]);Ne=!0}},o(m){S(o.$$.fragment,m),S(d.$$.fragment,m),S(g.$$.fragment,m),S(V.$$.fragment,m),S(oe.$$.fragment,m),S(me.$$.fragment,m),S(Ie.$$.fragment,m),S(Te.$$.fragment,m),U=U.filter(Boolean);for(let A=0;A<U.length;A+=1)S(U[A]);Ne=!1},d(m){m&&v(t),Y(o),Y(d),Y(g),Y(V),Y(oe),Y(me),Dt(x,m),Y(Ie),Y(Te),Dt(U,m),St=!1,At(Nt)}}}function Ql(e){let t,r,l,n;const a=[Zl,Wl],o=[];function c(s,d){return!s[0]||s[3].length==0||s[4]==!1?0:1}return t=c(e),r=o[t]=a[t](e),{c(){r.c(),l=Ce()},l(s){r.l(s),l=Ce()},m(s,d){o[t].m(s,d),se(s,l,d),n=!0},p(s,d){let k=t;t=c(s),t===k?o[t].p(s,d):(Qe(),S(o[k],1,1,()=>{o[k]=null}),We(),r=o[t],r?r.p(s,d):(r=o[t]=a[t](s),r.c()),I(r,1),r.m(l.parentNode,l))},i(s){n||(I(r),n=!0)},o(s){S(r),n=!1},d(s){s&&v(l),o[t].d(s)}}}function Wt(e){let t,r=e[62]+"",l;return{c(){t=w("label"),l=at(r),this.h()},l(n){t=$(n,"LABEL",{class:!0});var a=T(t);l=ot(a,r),a.forEach(v),this.h()},h(){p(t,"class","text-error-500")},m(n,a){se(n,t,a),u(t,l)},p(n,a){a[0]&4&&r!==(r=n[62]+"")&&it(l,r)},d(n){n&&v(t)}}}function Zt(e){let t,r=(e[59]=e[59].replaceAll(String.fromCharCode(e[0].textMarker),""))+"",l,n,a;function o(...f){return e[35](e[58],e[61],...f)}function c(...f){return e[36](e[58],e[61],...f)}function s(...f){return e[37](e[58],e[61],...f)}function d(...f){return e[38](e[58],e[61],...f)}function k(...f){return e[39](e[58],e[61],...f)}return{c(){t=w("td"),l=at(r),this.h()},l(f){t=$(f,"TD",{class:!0});var g=T(t);l=ot(g,r),g.forEach(v),this.h()},h(){var f,g,y,E,V;p(t,"class","hover:cursor-pointer select-none hover:border-surface-400 hover:border-solid hover:border-b-2"),ce(t,"variant-soft-error",((f=e[1].find(o))==null?void 0:f.type)===e[6].VARIABLE),ce(t,"variant-soft-success",((g=e[1].find(c))==null?void 0:g.type)===e[6].UNIT),ce(t,"variant-soft-warning",((y=e[1].find(s))==null?void 0:y.type)===e[6].DESCRIPTION),ce(t,"variant-soft-secondary",((E=e[1].find(d))==null?void 0:E.type)===e[6].MISSING_VALUES),ce(t,"variant-soft-primary",((V=e[1].find(k))==null?void 0:V.type)===e[6].DATA),ce(t,"variant-ghost-surface",e[3][e[58]][e[61]])},m(f,g){se(f,t,g),u(t,l),n||(a=[O(t,"dblclick",e[11](e[58])),O(t,"mousedown",e[9](e[58],e[61])),O(t,"mouseenter",e[10](e[58],e[61]))],n=!0)},p(f,g){var y,E,V,M,B;e=f,g[0]&1&&r!==(r=(e[59]=e[59].replaceAll(String.fromCharCode(e[0].textMarker),""))+"")&&it(l,r),g[0]&66&&ce(t,"variant-soft-error",((y=e[1].find(o))==null?void 0:y.type)===e[6].VARIABLE),g[0]&66&&ce(t,"variant-soft-success",((E=e[1].find(c))==null?void 0:E.type)===e[6].UNIT),g[0]&66&&ce(t,"variant-soft-warning",((V=e[1].find(s))==null?void 0:V.type)===e[6].DESCRIPTION),g[0]&66&&ce(t,"variant-soft-secondary",((M=e[1].find(d))==null?void 0:M.type)===e[6].MISSING_VALUES),g[0]&66&&ce(t,"variant-soft-primary",((B=e[1].find(k))==null?void 0:B.type)===e[6].DATA),g[0]&8&&ce(t,"variant-ghost-surface",e[3][e[58]][e[61]])},d(f){f&&v(t),n=!1,At(a)}}}function xt(e){let t,r,l,n,a,o,c,s,d;n=new ut({props:{icon:ml,size:"sm"}});let k=Xe(e[56].split(String.fromCharCode(e[0].delimeter))),f=[];for(let g=0;g<k.length;g+=1)f[g]=Zt(Xt(e,k,g));return{c(){t=w("tr"),r=w("td"),l=w("div"),j(n.$$.fragment),a=R();for(let g=0;g<f.length;g+=1)f[g].c();o=R(),this.h()},l(g){t=$(g,"TR",{});var y=T(t);r=$(y,"TD",{class:!0});var E=T(r);l=$(E,"DIV",{class:!0});var V=T(l);z(n.$$.fragment,V),V.forEach(v),E.forEach(v),a=P(y);for(let M=0;M<f.length;M+=1)f[M].l(y);o=P(y),y.forEach(v),this.h()},h(){p(l,"class","pt-1"),p(r,"class","w-8 hover:cursor-pointer select-none text-sm hover:border-surface-400 hover:border-solid hover:border-b-2")},m(g,y){se(g,t,y),u(t,r),u(r,l),G(n,l,null),u(t,a);for(let E=0;E<f.length;E+=1)f[E]&&f[E].m(t,null);u(t,o),c=!0,s||(d=O(r,"mousedown",e[16](e[58])),s=!0)},p(g,y){if(e=g,y[0]&3659){k=Xe(e[56].split(String.fromCharCode(e[0].delimeter)));let E;for(E=0;E<k.length;E+=1){const V=Xt(e,k,E);f[E]?f[E].p(V,y):(f[E]=Zt(V),f[E].c(),f[E].m(t,o))}for(;E<f.length;E+=1)f[E].d(1);f.length=k.length}},i(g){c||(I(n.$$.fragment,g),c=!0)},o(g){S(n.$$.fragment,g),c=!1},d(g){g&&v(t),Y(n),Dt(f,g),s=!1,d()}}}function Wl(e){let t,r,l;return r=new Lt({props:{position:ll.center,label:"Generate Structure..."}}),{c(){t=w("div"),j(r.$$.fragment),this.h()},l(n){t=$(n,"DIV",{class:!0});var a=T(t);z(r.$$.fragment,a),a.forEach(v),this.h()},h(){p(t,"class","h-full w-full text-surface-700")},m(n,a){se(n,t,a),G(r,t,null),l=!0},p:st,i(n){l||(I(r.$$.fragment,n),l=!0)},o(n){S(r.$$.fragment,n),l=!1},d(n){n&&v(t),Y(r)}}}function Zl(e){let t,r,l;return r=new Lt({props:{position:ll.center,label:"Loading Structure Suggestion based on: "+e[0].file}}),{c(){t=w("div"),j(r.$$.fragment),this.h()},l(n){t=$(n,"DIV",{class:!0});var a=T(t);z(r.$$.fragment,a),a.forEach(v),this.h()},h(){p(t,"class","h-full w-full text-surface-700")},m(n,a){se(n,t,a),G(r,t,null),l=!0},p(n,a){const o={};a[0]&1&&(o.label="Loading Structure Suggestion based on: "+n[0].file),r.$set(o)},i(n){l||(I(r.$$.fragment,n),l=!0)},o(n){S(r.$$.fragment,n),l=!1},d(n){n&&v(t),Y(r)}}}function xl(e){let t,r,l,n;const a=[Ql,Xl],o=[];function c(s,d){return!s[0]||s[3].length==0||s[4]==!1?0:1}return t=c(e),r=o[t]=a[t](e),{c(){r.c(),l=Ce()},l(s){r.l(s),l=Ce()},m(s,d){o[t].m(s,d),se(s,l,d),n=!0},p(s,d){let k=t;t=c(s),t===k?o[t].p(s,d):(Qe(),S(o[k],1,1,()=>{o[k]=null}),We(),r=o[t],r?r.p(s,d):(r=o[t]=a[t](s),r.c()),I(r,1),r.m(l.parentNode,l))},i(s){n||(I(r),n=!0)},o(s){S(r),n=!1},d(s){s&&v(l),o[t].d(s)}}}const er=e=>e.preventDefault();function tr(e,t,r){let{model:l}=t,{init:n=!0}=t,a=!1,o=[],c=[],s=0,d=0,k=!0,f=0,g=[];const y={VARIABLE:"variable",DESCRIPTION:"description",UNIT:"unit",MISSING_VALUES:"missing-values",DATA:"data"};let E=!1;const V=nl();vl(async()=>{console.log("start selection suggestion"),console.log("load selection",l.entityId,l.file),M(l.preview,String.fromCharCode(l.delimeter)),B(l.markers,n),l.delimeter,_()});function M(i,b){console.log("set table infos"),s=i[0].split(b).length,d=i.length,r(3,o=new Array(d).fill(!1));for(var h=0;h<o.length;h++)r(3,o[h]=new Array(s).fill(!1),o);console.log("state",o)}function B(i,b=!1){for(var h=0;h<i.length;h++){let X=i[h];console.log("marker",X),b?ae(X.type,X.row-1,X.cells):ae(X.type,X.row,X.cells)}}function N(i){a=!0}function C(i){a=!1}const ee=(i,b)=>h=>{console.log(h.type),(h.which===3||h.button===2)&&console.log("Right mouse button at "+h.clientX+"x"+h.clientY),i!=f&&L(),(a||h.type==="mousedown")&&(f=i,(h.which===1||h.button===0)&&de(b),(h.which===3||h.button===2)&&ge(b))},H=(i,b)=>h=>{(a||h.type==="mousedown")&&((h.which===1||h.button===0)&&de(b),(h.which===3||h.button===2)&&ge(b))},K=i=>b=>{console.log("dblclick",b.type,a),(a||b.type==="dblclick")&&J(f)},de=i=>{r(3,o[f][i]=!0,o)},ge=i=>{if(r(3,o[f][i]=!1,o),console.log("deselect"),c.length>0){console.log("selection l:",c.length);for(let b=0;b<c.length;b++){const h=c[b];h&&(h.cells[i]=!1,ae(h.type,h.row,h.cells))}}te(),_()},J=i=>{console.log("set true");for(var b=0;b<s;b++)console.log("select row",s),r(3,o[i][b]=!0,o)};function L(){r(3,o=new Array(d).fill(!1));for(var i=0;i<o.length;i++)r(3,o[i]=new Array(s).fill(!1),o)}function be(){r(1,c=[]),r(5,E=!1)}function te(){r(1,c=c.filter(i=>i.cells.find(b=>b===!0)))}function pe(i){let b=o[f];c.length>0&&(b=c[0].cells),ae(i,f,b),_()}function ae(i,b,h){let X={type:i,row:b,cells:h},W=c.find(Q=>Q.row==X.row);W&&r(1,c=c.filter(Q=>Q.row!==X.row)),W=c.find(Q=>Q.type==X.type),W&&r(1,c=c.filter(Q=>Q.type!==X.type)),r(1,c=[...c,X])}function _(){var X;r(2,g=[]);let i=c.find(W=>W.type==y.VARIABLE),b=c.find(W=>W.type==y.DATA);if(c.length>0){i||g.push("the variables still need to be marked"),b||g.push("the data still need to be marked");let W=0;for(let Q=0;Q<c.length;Q++){const rt=c[Q];console.log(Q,rt);let ze=(X=rt.cells.filter(Be=>Be==!0))==null?void 0:X.length;if(Q>0&&ze!=W){g.push("selection mismatch, the rows must have the same number of marked cells  ");break}W=ze}r(5,E=g.length==0)}else r(5,E=!1),r(2,g=[])}async function q(){if(r(4,k=!0),r(0,l.markers=c,l),l.entityId>0){console.log("save selection",l);let i=await Rl(l);console.log(i),i!=!1&&(console.log("selection",i),V("saved",l),r(4,k=!1))}else V("saved",l),r(4,k=!1)}function ne(){M(l.preview,String.fromCharCode(l.delimeter))}const F=i=>b=>{console.log(i,b.which,b.button),(b.which===1||b.button===0)&&(L(),console.log(i),J(i),f=i),(b.which===3||b.button===2)&&L()};async function oe(i){const b=i;console.log("🚀 ~ e.detail:",i);const h=await al(l.file,l.entityId,b,0);r(0,l.preview=h.preview,l)}function De(i){e.$$.not_equal(l.delimeter,i)&&(l.delimeter=i,r(0,l))}function ie(i){e.$$.not_equal(l.decimal,i)&&(l.decimal=i,r(0,l))}function me(i){e.$$.not_equal(l.textMarker,i)&&(l.textMarker=i,r(0,l))}function Ze(i){e.$$.not_equal(l.fileEncoding,i)&&(l.fileEncoding=i,r(0,l))}const xe=()=>pe(y.VARIABLE),ve=()=>Ve.show("selectVar"),ke=()=>Ve.show("selectUnit"),et=()=>pe(y.UNIT),Ae=()=>Ve.show("selectDescription"),_e=()=>pe(y.DESCRIPTION),Ie=()=>Ve.show("selectMissingValues"),je=()=>pe(y.MISSING_VALUES),tt=()=>Ve.show("selectData"),Le=()=>pe(y.DATA),Te=()=>Ve.show("resetSelection");function lt(i){e.$$.not_equal(l.missingValues,i)&&(l.missingValues=i,r(0,l))}const he=(i,b,h)=>h.row===i&&h.cells[b]===!0,le=(i,b,h)=>h.row===i&&h.cells[b]===!0,Se=(i,b,h)=>h.row===i&&h.cells[b]===!0,Me=(i,b,h)=>h.row===i&&h.cells[b]===!0,ft=(i,b,h)=>h.row===i&&h.cells[b]===!0;return e.$$set=i=>{"model"in i&&r(0,l=i.model),"init"in i&&r(18,n=i.init)},e.$$.update=()=>{e.$$.dirty[0]&1,e.$$.dirty[0]&2,e.$$.dirty[0]&4},[l,c,g,o,k,E,y,N,C,ee,H,K,be,pe,q,ne,F,oe,n,De,ie,me,Ze,xe,ve,ke,et,Ae,_e,Ie,je,tt,Le,Te,lt,he,le,Se,Me,ft]}class lr extends wt{constructor(t){super(),$t(this,t,tr,xl,yt,{model:0,init:18},null,[-1,-1,-1])}}function rr(e){let t,r;return t=new El({props:{error:e[14]}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p:st,i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){S(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function nr(e){let t,r,l=e[0]&&el(e);return{c(){l&&l.c(),t=Ce()},l(n){l&&l.l(n),t=Ce()},m(n,a){l&&l.m(n,a),se(n,t,a),r=!0},p(n,a){n[0]?l?(l.p(n,a),a&1&&I(l,1)):(l=el(n),l.c(),I(l,1),l.m(t.parentNode,t)):l&&(Qe(),S(l,1,1,()=>{l=null}),We())},i(n){r||(I(l),r=!0)},o(n){S(l),r=!1},d(n){n&&v(t),l&&l.d(n)}}}function el(e){let t,r,l,n;const a=[ar,sr],o=[];function c(s,d){return s[1]?0:s[0].variables?1:-1}return~(t=c(e))&&(r=o[t]=a[t](e)),{c(){r&&r.c(),l=Ce()},l(s){r&&r.l(s),l=Ce()},m(s,d){~t&&o[t].m(s,d),se(s,l,d),n=!0},p(s,d){let k=t;t=c(s),t===k?~t&&o[t].p(s,d):(r&&(Qe(),S(o[k],1,1,()=>{o[k]=null}),We()),~t?(r=o[t],r?r.p(s,d):(r=o[t]=a[t](s),r.c()),I(r,1),r.m(l.parentNode,l)):r=null)},i(s){n||(I(r),n=!0)},o(s){S(r),n=!1},d(s){s&&v(l),~t&&o[t].d(s)}}}function sr(e){let t,r;return t=new Gl({props:{model:e[0]}}),t.$on("back",e[6]),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p(l,n){const a={};n&1&&(a.model=l[0]),t.$set(a)},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){S(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function ar(e){let t,r,l,n,a;function o(s){e[7](s)}let c={init:e[2]};return e[0]!==void 0&&(c.model=e[0]),r=new lr({props:c}),ye.push(()=>$e(r,"model",o)),r.$on("saved",e[5]),{c(){t=w("div"),j(r.$$.fragment)},l(s){t=$(s,"DIV",{});var d=T(t);z(r.$$.fragment,d),d.forEach(v)},m(s,d){se(s,t,d),G(r,t,null),a=!0},p(s,d){const k={};d&4&&(k.init=s[2]),!l&&d&1&&(l=!0,k.model=s[0],Ee(()=>l=!1)),r.$set(k)},i(s){a||(I(r.$$.fragment,s),s&&rl(()=>{a&&(n||(n=vt(t,kt,{},!0)),n.run(1))}),a=!0)},o(s){S(r.$$.fragment,s),s&&(n||(n=vt(t,kt,{},!1)),n.run(0)),a=!1},d(s){s&&v(t),Y(r),s&&n&&n.end()}}}function or(e){let t,r;return t=new Lt({props:{label:e[3]}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p(l,n){const a={};n&8&&(a.label=l[3]),t.$set(a)},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){S(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function ir(e){let t,r,l={ctx:e,current:null,token:null,hasCatch:!0,pending:or,then:nr,catch:rr,error:14,blocks:[,,,]};return $l(e[4](),l),{c(){t=Ce(),l.block.c()},l(n){t=Ce(),l.block.l(n)},m(n,a){se(n,t,a),l.block.m(n,l.anchor=a),l.mount=()=>t.parentNode,l.anchor=t,r=!0},p(n,a){e=n,yl(l,e,a)},i(n){r||(I(l.block),r=!0)},o(n){for(let a=0;a<3;a+=1){const o=l.blocks[a];S(o)}r=!1},d(n){n&&v(t),l.block.d(n),l.token=null,l=null}}}function ur(e){let t,r;return t=new _l({props:{title:"Data structure",note:"This page allows you to create and edit a selected data structure.",contentLayoutType:hl.full,help:!0,$$slots:{default:[ir]},$$scope:{ctx:e}}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p(l,[n]){const a={};n&32783&&(a.$$scope={dirty:n,ctx:l}),t.$set(a)},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){S(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function fr(e,t,r){let l=Sl,n,a,o=0,c,s,d=!0,k=!0,f="the structure is loading";async function g(){var de,ge,J,L,be;Ve.setHelpItemList(l),n=document.getElementById("datastructure"),a=Number(n==null?void 0:n.getAttribute("dataset")),Number(n==null?void 0:n.getAttribute("version")),c=""+(n==null?void 0:n.getAttribute("file")),o=Number(n==null?void 0:n.getAttribute("structure")),c&&r(3,f="the file "+c+" is currently being analyzed");const M=((de=n==null?void 0:n.getAttribute("isTemplateRequired"))==null?void 0:de.toLocaleLowerCase())=="true";Vl.set(M);const B=((ge=n==null?void 0:n.getAttribute("isMeaningRequired"))==null?void 0:ge.toLocaleLowerCase())=="true";Dl.set(B);const N=((J=n==null?void 0:n.getAttribute("setByTemplate"))==null?void 0:J.toLocaleLowerCase())=="true";Al.set(N);const C=((L=n==null?void 0:n.getAttribute("enforcePrimaryKey"))==null?void 0:L.toLocaleLowerCase())=="true";sl.set(C);const ee=((be=n==null?void 0:n.getAttribute("changeablePrimaryKey"))==null?void 0:be.toLocaleLowerCase())=="true";Ll.set(ee),console.log("🚀 ~ file: +page.svelte:69 ~ start ~ file:",c),c!=""?(console.log("file exist",c,a,0),r(0,s=await al(c,a,65001,0)),console.log("🚀 ~ start ~ model:",s)):o>0?(console.log("copy structure"),r(0,s=await Pl(o)),r(1,d=!1)):(console.log("empty structure"),r(0,s=await Ul()),r(1,d=!1));const H=await Ol();Ml.set(H);const K=await ql();Bl.set(K)}async function y(M){console.log("update",M.detail),r(0,s=M.detail);let B=await Hl(M.detail);B!=!1&&(r(0,s=B),r(1,d=!1))}function E(){r(1,d=!0),r(2,k=!1)}function V(M){s=M,r(0,s)}return e.$$.update=()=>{e.$$.dirty&1},[s,d,k,f,g,y,E,V]}class yr extends wt{constructor(t){super(),$t(this,t,fr,ur,yt,{})}}export{yr as component,$r as universal};
