import{S as $t,i as yt,f as $e,c as j,a as z,m as G,t as I,g as We,b as T,e as Ze,h as kt,d as Y}from"../chunks/index.DWlViqnX.js";import{F as ft,c as ml,d as rl,g as wt,a as Ve,l as _l,e as Je,m as hl,o as nl,P as bl,p as vl}from"../chunks/eslint4b.es.Bsf3VjZw.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.5nEx3X7q.js";import{s as Et,F as ye,e as k,l as R,c as w,h as S,d as v,o as P,a as p,i as se,p as u,x as O,P as Ee,H as sl,B as Lt,R as al,Q as kl,g as we,n as at,j as Ce,S as wl,N as $l,t as ot,m as it,L as yl,q as ut,k as At,I as ce}from"../chunks/scheduler.DXasKYkc.js";import{S as Mt,h as El,u as Cl,E as Il}from"../chunks/ErrorMessage.zD3AipS3.js";import{A as Sl,V as Tl,a as Vl,d as Dl}from"../chunks/help.B71RdopB.js";import{e as ol,i as Al,a as Ll,s as Ml,c as Bl,b as Nl,d as Rl}from"../chunks/types.w0DiU5pq.js";import{d as Pl,e as Ul,l as il,f as Ol,h as ql,a as Hl,b as Kl,i as Fl}from"../chunks/services.65Kgv6y3.js";import{g as Dt}from"../chunks/BaseCaller.DKaNiEEY.js";import{D as vt}from"../chunks/DropdownKvP.DCD9qsR8.js";import{M as jl}from"../chunks/MissingValues.DcVRA6Ax.js";function zl(){return{}}const Er=Object.freeze(Object.defineProperty({__proto__:null,load:zl},Symbol.toStringTag,{value:"Module"}));function Xt(e){let t,r;return t=new Vl({props:{message:"please select a primary key",cssClass:"variant-filled-warning"}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){T(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function Gl(e){let t,r,l,n,a,o,c,s,d,$,f,g,y,E,V,M,B,N,C,ee,H,K,de;a=new ft({props:{icon:ml}}),d=new ft({props:{icon:rl}});function ge(_){e[11](_)}let Q={model:e[0]};e[2]!==void 0&&(Q.valid=e[2]),y=new Sl({props:Q}),ye.push(()=>$e(y,"valid",ge));let L=e[4]&&e[0].variables.length>0&&!e[3]&&Xt();function be(_){e[12](_)}function te(_){e[13](_)}function pe(_){e[14](_)}let ae={data:e[6]()};return e[0].variables!==void 0&&(ae.variables=e[0].variables),e[1]!==void 0&&(ae.valid=e[1]),e[0].missingValues!==void 0&&(ae.missingValues=e[0].missingValues),B=new Tl({props:ae}),ye.push(()=>$e(B,"variables",be)),ye.push(()=>$e(B,"valid",te)),ye.push(()=>$e(B,"missingValues",pe)),{c(){t=k("div"),r=k("div"),l=k("div"),n=k("button"),j(a.$$.fragment),o=R(),c=k("div"),s=k("button"),j(d.$$.fragment),g=R(),j(y.$$.fragment),V=R(),L&&L.c(),M=R(),j(B.$$.fragment),this.h()},l(_){t=w(_,"DIV",{});var q=S(t);r=w(q,"DIV",{class:!0});var ne=S(r);l=w(ne,"DIV",{class:!0});var F=S(l);n=w(F,"BUTTON",{id:!0,title:!0,class:!0});var oe=S(n);z(a.$$.fragment,oe),oe.forEach(v),F.forEach(v),o=P(ne),c=w(ne,"DIV",{class:!0});var De=S(c);s=w(De,"BUTTON",{id:!0,title:!0,class:!0});var ie=S(s);z(d.$$.fragment,ie),ie.forEach(v),De.forEach(v),ne.forEach(v),g=P(q),z(y.$$.fragment,q),V=P(q),L&&L.l(q),M=P(q),z(B.$$.fragment,q),q.forEach(v),this.h()},h(){p(n,"id","back"),p(n,"title","back"),p(n,"class","btn variant-filled-warning"),p(l,"class","grow"),p(s,"id","save"),p(s,"title","save"),p(s,"class","btn variant-filled-primary text-xl"),s.disabled=$=!e[1]||!e[2]||!(e[4]&&e[3]||!e[4]),p(c,"class","flex-none text-end"),p(r,"class","flex")},m(_,q){se(_,t,q),u(t,r),u(r,l),u(l,n),G(a,n,null),u(r,o),u(r,c),u(c,s),G(d,s,null),u(t,g),G(y,t,null),u(t,V),L&&L.m(t,null),u(t,M),G(B,t,null),H=!0,K||(de=[O(n,"mouseover",e[8]),O(n,"click",e[9]),O(s,"mouseover",e[10]),O(s,"click",e[5])],K=!0)},p(_,[q]){(!H||q&14&&$!==($=!_[1]||!_[2]||!(_[4]&&_[3]||!_[4])))&&(s.disabled=$);const ne={};q&1&&(ne.model=_[0]),!E&&q&4&&(E=!0,ne.valid=_[2],Ee(()=>E=!1)),y.$set(ne),_[4]&&_[0].variables.length>0&&!_[3]?L?q&9&&I(L,1):(L=Xt(),L.c(),I(L,1),L.m(t,M)):L&&(We(),T(L,1,1,()=>{L=null}),Ze());const F={};!N&&q&1&&(N=!0,F.variables=_[0].variables,Ee(()=>N=!1)),!C&&q&2&&(C=!0,F.valid=_[1],Ee(()=>C=!1)),!ee&&q&1&&(ee=!0,F.missingValues=_[0].missingValues,Ee(()=>ee=!1)),B.$set(F)},i(_){H||(I(a.$$.fragment,_),I(d.$$.fragment,_),_&&sl(()=>{H&&(f||(f=kt(r,wt,{},!0)),f.run(1))}),I(y.$$.fragment,_),I(L),I(B.$$.fragment,_),H=!0)},o(_){T(a.$$.fragment,_),T(d.$$.fragment,_),_&&(f||(f=kt(r,wt,{},!1)),f.run(0)),T(y.$$.fragment,_),T(L),T(B.$$.fragment,_),H=!1},d(_){_&&v(t),Y(a),Y(d),_&&f&&f.end(),Y(y),L&&L.d(),Y(B),K=!1,Lt(de)}}}function Yl(e,t,r){let l,n=!1,a=!1;al();let{model:o}=t,c=kl(ol);function s(){var ee;let C=!1;(ee=o.variables)==null||ee.forEach(H=>{H.isKey==!0&&(C=!0)}),r(3,l=C)}async function d(){const C=await Pl(o);console.log("save",C),o.entityId>0?Dt("/dcm/edit?id="+o.entityId):Dt("/rpm/datastructure")}function $(){let C=[];if(o&&o.markers){const ee=o.markers.find(H=>H.type=="data");if(ee)for(let H=ee.row;H<o.preview.length;H++){const K=o.preview[H];C.push(K.split(String.fromCharCode(o.delimeter)))}}return C}function f(){Dt(document.referrer)}const g=()=>Ve.show("back"),y=()=>f(),E=()=>Ve.show("save");function V(C){a=C,r(2,a)}function M(C){e.$$.not_equal(o.variables,C)&&(o.variables=C,r(0,o))}function B(C){n=C,r(1,n)}function N(C){e.$$.not_equal(o.missingValues,C)&&(o.missingValues=C,r(0,o))}return e.$$set=C=>{"model"in C&&r(0,o=C.model)},e.$$.update=()=>{e.$$.dirty&1&&s()},r(3,l=!1),[o,n,a,l,c,d,$,f,g,y,E,V,M,B,N]}class Ql extends $t{constructor(t){super(),yt(this,t,Yl,Gl,Et,{model:0})}}function Xl(e){let t,r='<h4 class="h4">Controls</h4> <hr class="divide-x-8"/> <dl class="list-dl gap-0"><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Selection</dt> <dd>left mouse button</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Drag</dt> <dd>left mouse button down and drag</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Deselect</dt> <dd>right mouse button click</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Select Row</dt> <dd>double click left mouse button or click arrow</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Deselect Row</dt> <dd>right mouse button click on arrow</dd></span></div></dl>';return{c(){t=k("div"),t.innerHTML=r,this.h()},l(l){t=w(l,"DIV",{class:!0,"data-svelte-h":!0}),we(t)!=="svelte-1p56ohu"&&(t.innerHTML=r),this.h()},h(){p(t,"class","col-span-1 card p-5 text-sm")},m(l,n){se(l,t,n)},p:at,i:at,o:at,d(l){l&&v(t)}}}class Jl extends $t{constructor(t){super(),yt(this,t,null,Xl,Et,{})}}function Jt(e,t,r){const l=e.slice();return l[56]=t[r],l[58]=r,l}function Wt(e,t,r){const l=e.slice();return l[59]=t[r],l[61]=r,l}function Zt(e,t,r){const l=e.slice();return l[62]=t[r],l}function Wl(e){let t,r,l,n,a,o,c,s,d,$,f,g,y,E,V,M,B,N,C,ee="Variable",H,K,de="Unit",ge,Q,L="Description",be,te,pe="Missing Values",ae,_,q="Data",ne,F,oe,De,ie,me,xe,et,ve,ke,tt,Ae,_e,Ie,je,lt,Le,Se,rt,he,le,Te,Me,ct="Total:",i,b=e[0].total+"",h,X,W,J,nt="Found:",ze,Be=e[0].total-e[0].skipped+"",dt,Ct,Oe,Ge,Bt="Skipped:",It,st=e[0].skipped+"",gt,St,qe,Nt="<i>you see only the first 10 rows of the data</i>",Tt,Ye,He,Qe,Ne,Vt,Rt;function ul(m){e[19](m)}let Pt={id:"delimeter",title:"Delimeter",source:e[0].delimeters,complexTarget:!1,help:!0};e[0].delimeter!==void 0&&(Pt.target=e[0].delimeter),o=new vt({props:Pt}),ye.push(()=>$e(o,"target",ul)),o.$on("change",e[15]);function fl(m){e[20](m)}let Ut={id:"decimal",title:"Decimal",source:e[0].decimals,complexTarget:!1,help:!0};e[0].decimal!==void 0&&(Ut.target=e[0].decimal),d=new vt({props:Ut}),ye.push(()=>$e(d,"target",fl));function cl(m){e[21](m)}let Ot={id:"textMarker",title:"TextMarker",source:e[0].textMarkers,complexTarget:!1,help:!0};e[0].textMarker!==void 0&&(Ot.target=e[0].textMarker),g=new vt({props:Ot}),ye.push(()=>$e(g,"target",cl));function dl(m){e[22](m)}let qt={id:"encoding",title:"Encoding",source:e[0].encodings,complexTarget:!1,help:!0};e[0].fileEncoding!==void 0&&(qt.target=e[0].fileEncoding),V=new vt({props:qt}),ye.push(()=>$e(V,"target",dl)),V.$on("change",function(){$l(e[17](e[0].fileEncoding))&&e[17](e[0].fileEncoding).apply(this,arguments)}),oe=new ft({props:{icon:_l}});function gl(m){e[34](m)}let Ht={};e[0].missingValues!==void 0&&(Ht.list=e[0].missingValues),me=new jl({props:Ht}),ye.push(()=>$e(me,"list",gl));let Xe=Je(e[2]),x=[];for(let m=0;m<Xe.length;m+=1)x[m]=xt(Zt(e,Xe,m));Ie=new ft({props:{icon:rl}}),Se=new Jl({});let Ke=Je(e[0].preview),U=[];for(let m=0;m<Ke.length;m+=1)U[m]=tl(Jt(e,Ke,m));const pl=m=>T(U[m],1,1,()=>{U[m]=null});return{c(){t=k("form"),r=k("div"),l=k("div"),n=k("div"),a=k("div"),j(o.$$.fragment),s=R(),j(d.$$.fragment),f=R(),j(g.$$.fragment),E=R(),j(V.$$.fragment),B=R(),N=k("div"),C=k("button"),C.textContent=ee,H=R(),K=k("button"),K.textContent=de,ge=R(),Q=k("button"),Q.textContent=L,be=R(),te=k("button"),te.textContent=pe,ae=R(),_=k("button"),_.textContent=q,ne=R(),F=k("button"),j(oe.$$.fragment),De=R(),ie=k("div"),j(me.$$.fragment),et=R(),ve=k("div"),ke=k("div");for(let m=0;m<x.length;m+=1)x[m].c();tt=R(),Ae=k("div"),_e=k("button"),j(Ie.$$.fragment),lt=R(),Le=k("div"),j(Se.$$.fragment),rt=R(),he=k("div"),le=k("div"),Te=k("label"),Me=k("b"),Me.textContent=ct,i=R(),h=ot(b),X=R(),W=k("label"),J=k("b"),J.textContent=nt,ze=R(),dt=ot(Be),Ct=R(),Oe=k("label"),Ge=k("b"),Ge.textContent=Bt,It=R(),gt=ot(st),St=R(),qe=k("label"),qe.innerHTML=Nt,Tt=R(),Ye=k("div"),He=k("table"),Qe=k("tbody");for(let m=0;m<U.length;m+=1)U[m].c();this.h()},l(m){t=w(m,"FORM",{});var A=S(t);r=w(A,"DIV",{id:!0,class:!0});var Z=S(r);l=w(Z,"DIV",{class:!0});var Re=S(l);n=w(Re,"DIV",{id:!0,class:!0});var ue=S(n);a=w(ue,"DIV",{id:!0,class:!0});var fe=S(a);z(o.$$.fragment,fe),s=P(fe),z(d.$$.fragment,fe),f=P(fe),z(g.$$.fragment,fe),E=P(fe),z(V.$$.fragment,fe),fe.forEach(v),B=P(ue),N=w(ue,"DIV",{id:!0,class:!0});var re=S(N);C=w(re,"BUTTON",{class:!0,id:!0,type:!0,"data-svelte-h":!0}),we(C)!=="svelte-1vcmr03"&&(C.textContent=ee),H=P(re),K=w(re,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),we(K)!=="svelte-1uhcbun"&&(K.textContent=de),ge=P(re),Q=w(re,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),we(Q)!=="svelte-1cfm3l4"&&(Q.textContent=L),be=P(re),te=w(re,"BUTTON",{class:!0,type:!0,color:!0,id:!0,"data-svelte-h":!0}),we(te)!=="svelte-1v4zuqe"&&(te.textContent=pe),ae=P(re),_=w(re,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),we(_)!=="svelte-pjfsfy"&&(_.textContent=q),ne=P(re),F=w(re,"BUTTON",{title:!0,id:!0,class:!0,type:!0});var D=S(F);z(oe.$$.fragment,D),D.forEach(v),re.forEach(v),De=P(ue),ie=w(ue,"DIV",{id:!0,class:!0});var Pe=S(ie);z(me.$$.fragment,Pe),Pe.forEach(v),et=P(ue),ve=w(ue,"DIV",{class:!0});var pt=S(ve);ke=w(pt,"DIV",{id:!0,class:!0});var Kt=S(ke);for(let Fe=0;Fe<x.length;Fe+=1)x[Fe].l(Kt);Kt.forEach(v),tt=P(pt),Ae=w(pt,"DIV",{class:!0});var Ft=S(Ae);_e=w(Ft,"BUTTON",{title:!0,class:!0});var jt=S(_e);z(Ie.$$.fragment,jt),jt.forEach(v),Ft.forEach(v),pt.forEach(v),ue.forEach(v),lt=P(Re),Le=w(Re,"DIV",{class:!0});var zt=S(Le);z(Se.$$.fragment,zt),zt.forEach(v),Re.forEach(v),rt=P(Z),he=w(Z,"DIV",{id:!0,class:!0});var mt=S(he);le=w(mt,"DIV",{id:!0,class:!0});var Ue=S(le);Te=w(Ue,"LABEL",{});var _t=S(Te);Me=w(_t,"B",{"data-svelte-h":!0}),we(Me)!=="svelte-sykk0o"&&(Me.textContent=ct),i=P(_t),h=it(_t,b),_t.forEach(v),X=P(Ue),W=w(Ue,"LABEL",{});var ht=S(W);J=w(ht,"B",{"data-svelte-h":!0}),we(J)!=="svelte-5ox7e6"&&(J.textContent=nt),ze=P(ht),dt=it(ht,Be),ht.forEach(v),Ct=P(Ue),Oe=w(Ue,"LABEL",{});var bt=S(Oe);Ge=w(bt,"B",{"data-svelte-h":!0}),we(Ge)!=="svelte-1pbimz2"&&(Ge.textContent=Bt),It=P(bt),gt=it(bt,st),bt.forEach(v),St=P(Ue),qe=w(Ue,"LABEL",{class:!0,"data-svelte-h":!0}),we(qe)!=="svelte-klacyg"&&(qe.innerHTML=Nt),Ue.forEach(v),Tt=P(mt),Ye=w(mt,"DIV",{class:!0});var Gt=S(Ye);He=w(Gt,"TABLE",{class:!0});var Yt=S(He);Qe=w(Yt,"TBODY",{});var Qt=S(Qe);for(let Fe=0;Fe<U.length;Fe+=1)U[Fe].l(Qt);Qt.forEach(v),Yt.forEach(v),Gt.forEach(v),mt.forEach(v),Z.forEach(v),A.forEach(v),this.h()},h(){p(a,"id","reader selections"),p(a,"class","flex flex-none gap-2"),p(C,"class","btn variant-filled-error"),p(C,"id","selectVar"),p(C,"type","button"),p(K,"class","btn variant-filled-success"),p(K,"type","button"),p(K,"id","selectUnit"),p(Q,"class","btn variant-filled-warning"),p(Q,"type","button"),p(Q,"id","selectDescription"),p(te,"class","btn variant-filled-secondary"),p(te,"type","button"),p(te,"color","info"),p(te,"id","selectMissingValues"),p(_,"class","btn variant-filled-primary"),p(_,"type","button"),p(_,"id","selectData"),p(F,"title","reset selection"),p(F,"id","resetSelection"),p(F,"class","btn variant-filled-warning text-lg"),p(F,"type","button"),p(N,"id","markers"),p(N,"class","py-5 flex gap-1"),p(ie,"id","missingvalues"),p(ie,"class","grow"),p(ke,"id","errors"),p(ke,"class","m-2 text-sm grow text-right"),p(_e,"title","save"),p(_e,"class","btn variant-filled-primary text-lg"),_e.disabled=je=!e[5],p(Ae,"class","text-right"),p(ve,"class","flex"),p(n,"id","edit"),p(n,"class","flex flex-col grow gap-2"),p(Le,"class","controls"),p(l,"class","flex gap-5"),p(qe,"class","grow text-right"),p(le,"id","data infos"),p(le,"class","flex flex-auto gap-5 pb-2"),p(He,"class","table table-compact"),p(Ye,"class","overflow-x-auto"),p(he,"id","preview data"),p(he,"class","flex-col py-5 "),p(r,"id","structure-suggestion-container"),p(r,"class","flex-col gap-3")},m(m,A){se(m,t,A),u(t,r),u(r,l),u(l,n),u(n,a),G(o,a,null),u(a,s),G(d,a,null),u(a,f),G(g,a,null),u(a,E),G(V,a,null),u(n,B),u(n,N),u(N,C),u(N,H),u(N,K),u(N,ge),u(N,Q),u(N,be),u(N,te),u(N,ae),u(N,_),u(N,ne),u(N,F),G(oe,F,null),u(n,De),u(n,ie),G(me,ie,null),u(n,et),u(n,ve),u(ve,ke);for(let Z=0;Z<x.length;Z+=1)x[Z]&&x[Z].m(ke,null);u(ve,tt),u(ve,Ae),u(Ae,_e),G(Ie,_e,null),u(l,lt),u(l,Le),G(Se,Le,null),u(r,rt),u(r,he),u(he,le),u(le,Te),u(Te,Me),u(Te,i),u(Te,h),u(le,X),u(le,W),u(W,J),u(W,ze),u(W,dt),u(le,Ct),u(le,Oe),u(Oe,Ge),u(Oe,It),u(Oe,gt),u(le,St),u(le,qe),u(he,Tt),u(he,Ye),u(Ye,He),u(He,Qe);for(let Z=0;Z<U.length;Z+=1)U[Z]&&U[Z].m(Qe,null);Ne=!0,Vt||(Rt=[O(C,"click",e[23]),O(C,"mouseover",e[24]),O(K,"mouseover",e[25]),O(K,"click",e[26]),O(Q,"mouseover",e[27]),O(Q,"click",e[28]),O(te,"mouseover",e[29]),O(te,"click",e[30]),O(_,"mouseover",e[31]),O(_,"click",e[32]),O(F,"mouseover",e[33]),O(F,"click",e[12]),O(He,"contextmenu",lr),O(r,"mousedown",e[7]),O(r,"mouseup",e[8]),O(t,"submit",yl(e[14]))],Vt=!0)},p(m,A){e=m;const Z={};A[0]&1&&(Z.source=e[0].delimeters),!c&&A[0]&1&&(c=!0,Z.target=e[0].delimeter,Ee(()=>c=!1)),o.$set(Z);const Re={};A[0]&1&&(Re.source=e[0].decimals),!$&&A[0]&1&&($=!0,Re.target=e[0].decimal,Ee(()=>$=!1)),d.$set(Re);const ue={};A[0]&1&&(ue.source=e[0].textMarkers),!y&&A[0]&1&&(y=!0,ue.target=e[0].textMarker,Ee(()=>y=!1)),g.$set(ue);const fe={};A[0]&1&&(fe.source=e[0].encodings),!M&&A[0]&1&&(M=!0,fe.target=e[0].fileEncoding,Ee(()=>M=!1)),V.$set(fe);const re={};if(!xe&&A[0]&1&&(xe=!0,re.list=e[0].missingValues,Ee(()=>xe=!1)),me.$set(re),A[0]&4){Xe=Je(e[2]);let D;for(D=0;D<Xe.length;D+=1){const Pe=Zt(e,Xe,D);x[D]?x[D].p(Pe,A):(x[D]=xt(Pe),x[D].c(),x[D].m(ke,null))}for(;D<x.length;D+=1)x[D].d(1);x.length=Xe.length}if((!Ne||A[0]&32&&je!==(je=!e[5]))&&(_e.disabled=je),(!Ne||A[0]&1)&&b!==(b=e[0].total+"")&&ut(h,b),(!Ne||A[0]&1)&&Be!==(Be=e[0].total-e[0].skipped+"")&&ut(dt,Be),(!Ne||A[0]&1)&&st!==(st=e[0].skipped+"")&&ut(gt,st),A[0]&69195){Ke=Je(e[0].preview);let D;for(D=0;D<Ke.length;D+=1){const Pe=Jt(e,Ke,D);U[D]?(U[D].p(Pe,A),I(U[D],1)):(U[D]=tl(Pe),U[D].c(),I(U[D],1),U[D].m(Qe,null))}for(We(),D=Ke.length;D<U.length;D+=1)pl(D);Ze()}},i(m){if(!Ne){I(o.$$.fragment,m),I(d.$$.fragment,m),I(g.$$.fragment,m),I(V.$$.fragment,m),I(oe.$$.fragment,m),I(me.$$.fragment,m),I(Ie.$$.fragment,m),I(Se.$$.fragment,m);for(let A=0;A<Ke.length;A+=1)I(U[A]);Ne=!0}},o(m){T(o.$$.fragment,m),T(d.$$.fragment,m),T(g.$$.fragment,m),T(V.$$.fragment,m),T(oe.$$.fragment,m),T(me.$$.fragment,m),T(Ie.$$.fragment,m),T(Se.$$.fragment,m),U=U.filter(Boolean);for(let A=0;A<U.length;A+=1)T(U[A]);Ne=!1},d(m){m&&v(t),Y(o),Y(d),Y(g),Y(V),Y(oe),Y(me),At(x,m),Y(Ie),Y(Se),At(U,m),Vt=!1,Lt(Rt)}}}function Zl(e){let t,r,l,n;const a=[er,xl],o=[];function c(s,d){return!s[0]||s[3].length==0||s[4]==!1?0:1}return t=c(e),r=o[t]=a[t](e),{c(){r.c(),l=Ce()},l(s){r.l(s),l=Ce()},m(s,d){o[t].m(s,d),se(s,l,d),n=!0},p(s,d){let $=t;t=c(s),t===$?o[t].p(s,d):(We(),T(o[$],1,1,()=>{o[$]=null}),Ze(),r=o[t],r?r.p(s,d):(r=o[t]=a[t](s),r.c()),I(r,1),r.m(l.parentNode,l))},i(s){n||(I(r),n=!0)},o(s){T(r),n=!1},d(s){s&&v(l),o[t].d(s)}}}function xt(e){let t,r=e[62]+"",l;return{c(){t=k("label"),l=ot(r),this.h()},l(n){t=w(n,"LABEL",{class:!0});var a=S(t);l=it(a,r),a.forEach(v),this.h()},h(){p(t,"class","text-error-500")},m(n,a){se(n,t,a),u(t,l)},p(n,a){a[0]&4&&r!==(r=n[62]+"")&&ut(l,r)},d(n){n&&v(t)}}}function el(e){let t,r=(e[59]=e[59].replaceAll(String.fromCharCode(e[0].textMarker),""))+"",l,n,a;function o(...f){return e[35](e[58],e[61],...f)}function c(...f){return e[36](e[58],e[61],...f)}function s(...f){return e[37](e[58],e[61],...f)}function d(...f){return e[38](e[58],e[61],...f)}function $(...f){return e[39](e[58],e[61],...f)}return{c(){t=k("td"),l=ot(r),this.h()},l(f){t=w(f,"TD",{class:!0});var g=S(t);l=it(g,r),g.forEach(v),this.h()},h(){var f,g,y,E,V;p(t,"class","hover:cursor-pointer select-none hover:border-surface-400 hover:border-solid hover:border-b-2"),ce(t,"variant-soft-error",((f=e[1].find(o))==null?void 0:f.type)===e[6].VARIABLE),ce(t,"variant-soft-success",((g=e[1].find(c))==null?void 0:g.type)===e[6].UNIT),ce(t,"variant-soft-warning",((y=e[1].find(s))==null?void 0:y.type)===e[6].DESCRIPTION),ce(t,"variant-soft-secondary",((E=e[1].find(d))==null?void 0:E.type)===e[6].MISSING_VALUES),ce(t,"variant-soft-primary",((V=e[1].find($))==null?void 0:V.type)===e[6].DATA),ce(t,"variant-ghost-surface",e[3][e[58]][e[61]])},m(f,g){se(f,t,g),u(t,l),n||(a=[O(t,"dblclick",e[11](e[58])),O(t,"mousedown",e[9](e[58],e[61])),O(t,"mouseenter",e[10](e[58],e[61]))],n=!0)},p(f,g){var y,E,V,M,B;e=f,g[0]&1&&r!==(r=(e[59]=e[59].replaceAll(String.fromCharCode(e[0].textMarker),""))+"")&&ut(l,r),g[0]&66&&ce(t,"variant-soft-error",((y=e[1].find(o))==null?void 0:y.type)===e[6].VARIABLE),g[0]&66&&ce(t,"variant-soft-success",((E=e[1].find(c))==null?void 0:E.type)===e[6].UNIT),g[0]&66&&ce(t,"variant-soft-warning",((V=e[1].find(s))==null?void 0:V.type)===e[6].DESCRIPTION),g[0]&66&&ce(t,"variant-soft-secondary",((M=e[1].find(d))==null?void 0:M.type)===e[6].MISSING_VALUES),g[0]&66&&ce(t,"variant-soft-primary",((B=e[1].find($))==null?void 0:B.type)===e[6].DATA),g[0]&8&&ce(t,"variant-ghost-surface",e[3][e[58]][e[61]])},d(f){f&&v(t),n=!1,Lt(a)}}}function tl(e){let t,r,l,n,a,o,c,s,d;n=new ft({props:{icon:hl,size:"sm"}});let $=Je(e[56].split(String.fromCharCode(e[0].delimeter))),f=[];for(let g=0;g<$.length;g+=1)f[g]=el(Wt(e,$,g));return{c(){t=k("tr"),r=k("td"),l=k("div"),j(n.$$.fragment),a=R();for(let g=0;g<f.length;g+=1)f[g].c();o=R(),this.h()},l(g){t=w(g,"TR",{});var y=S(t);r=w(y,"TD",{class:!0});var E=S(r);l=w(E,"DIV",{class:!0});var V=S(l);z(n.$$.fragment,V),V.forEach(v),E.forEach(v),a=P(y);for(let M=0;M<f.length;M+=1)f[M].l(y);o=P(y),y.forEach(v),this.h()},h(){p(l,"class","pt-1"),p(r,"class","w-8 hover:cursor-pointer select-none text-sm hover:border-surface-400 hover:border-solid hover:border-b-2")},m(g,y){se(g,t,y),u(t,r),u(r,l),G(n,l,null),u(t,a);for(let E=0;E<f.length;E+=1)f[E]&&f[E].m(t,null);u(t,o),c=!0,s||(d=O(r,"mousedown",e[16](e[58])),s=!0)},p(g,y){if(e=g,y[0]&3659){$=Je(e[56].split(String.fromCharCode(e[0].delimeter)));let E;for(E=0;E<$.length;E+=1){const V=Wt(e,$,E);f[E]?f[E].p(V,y):(f[E]=el(V),f[E].c(),f[E].m(t,o))}for(;E<f.length;E+=1)f[E].d(1);f.length=$.length}},i(g){c||(I(n.$$.fragment,g),c=!0)},o(g){T(n.$$.fragment,g),c=!1},d(g){g&&v(t),Y(n),At(f,g),s=!1,d()}}}function xl(e){let t,r,l;return r=new Mt({props:{position:nl.center,label:"Generate Structure..."}}),{c(){t=k("div"),j(r.$$.fragment),this.h()},l(n){t=w(n,"DIV",{class:!0});var a=S(t);z(r.$$.fragment,a),a.forEach(v),this.h()},h(){p(t,"class","h-full w-full text-surface-700")},m(n,a){se(n,t,a),G(r,t,null),l=!0},p:at,i(n){l||(I(r.$$.fragment,n),l=!0)},o(n){T(r.$$.fragment,n),l=!1},d(n){n&&v(t),Y(r)}}}function er(e){let t,r,l;return r=new Mt({props:{position:nl.center,label:"Loading Structure Suggestion based on: "+e[0].file}}),{c(){t=k("div"),j(r.$$.fragment),this.h()},l(n){t=w(n,"DIV",{class:!0});var a=S(t);z(r.$$.fragment,a),a.forEach(v),this.h()},h(){p(t,"class","h-full w-full text-surface-700")},m(n,a){se(n,t,a),G(r,t,null),l=!0},p(n,a){const o={};a[0]&1&&(o.label="Loading Structure Suggestion based on: "+n[0].file),r.$set(o)},i(n){l||(I(r.$$.fragment,n),l=!0)},o(n){T(r.$$.fragment,n),l=!1},d(n){n&&v(t),Y(r)}}}function tr(e){let t,r,l,n;const a=[Zl,Wl],o=[];function c(s,d){return!s[0]||s[3].length==0||s[4]==!1?0:1}return t=c(e),r=o[t]=a[t](e),{c(){r.c(),l=Ce()},l(s){r.l(s),l=Ce()},m(s,d){o[t].m(s,d),se(s,l,d),n=!0},p(s,d){let $=t;t=c(s),t===$?o[t].p(s,d):(We(),T(o[$],1,1,()=>{o[$]=null}),Ze(),r=o[t],r?r.p(s,d):(r=o[t]=a[t](s),r.c()),I(r,1),r.m(l.parentNode,l))},i(s){n||(I(r),n=!0)},o(s){T(r),n=!1},d(s){s&&v(l),o[t].d(s)}}}const lr=e=>e.preventDefault();function rr(e,t,r){let{model:l}=t,{init:n=!0}=t,a=!1,o=[],c=[],s=0,d=0,$=!0,f=0,g=[];const y={VARIABLE:"variable",DESCRIPTION:"description",UNIT:"unit",MISSING_VALUES:"missing-values",DATA:"data"};let E=!1;const V=al();wl(async()=>{console.log("start selection suggestion"),console.log("load selection",l.entityId,l.file),M(l.preview,String.fromCharCode(l.delimeter)),B(l.markers,n),l.delimeter,_()});function M(i,b){console.log("set table infos"),s=i[0].split(b).length,d=i.length,r(3,o=new Array(d).fill(!1));for(var h=0;h<o.length;h++)r(3,o[h]=new Array(s).fill(!1),o);console.log("state",o)}function B(i,b=!1){for(var h=0;h<i.length;h++){let X=i[h];console.log("marker",X),b?ae(X.type,X.row-1,X.cells):ae(X.type,X.row,X.cells)}}function N(i){a=!0}function C(i){a=!1}const ee=(i,b)=>h=>{console.log(h.type),(h.which===3||h.button===2)&&console.log("Right mouse button at "+h.clientX+"x"+h.clientY),i!=f&&L(),(a||h.type==="mousedown")&&(f=i,(h.which===1||h.button===0)&&de(b),(h.which===3||h.button===2)&&ge(b))},H=(i,b)=>h=>{(a||h.type==="mousedown")&&((h.which===1||h.button===0)&&de(b),(h.which===3||h.button===2)&&ge(b))},K=i=>b=>{console.log("dblclick",b.type,a),(a||b.type==="dblclick")&&Q(f)},de=i=>{r(3,o[f][i]=!0,o)},ge=i=>{if(r(3,o[f][i]=!1,o),console.log("deselect"),c.length>0){console.log("selection l:",c.length);for(let b=0;b<c.length;b++){const h=c[b];h&&(h.cells[i]=!1,ae(h.type,h.row,h.cells))}}te(),_()},Q=i=>{console.log("set true");for(var b=0;b<s;b++)console.log("select row",s),r(3,o[i][b]=!0,o)};function L(){r(3,o=new Array(d).fill(!1));for(var i=0;i<o.length;i++)r(3,o[i]=new Array(s).fill(!1),o)}function be(){r(1,c=[]),r(5,E=!1)}function te(){r(1,c=c.filter(i=>i.cells.find(b=>b===!0)))}function pe(i){let b=o[f];c.length>0&&(b=c[0].cells),ae(i,f,b),_()}function ae(i,b,h){let X={type:i,row:b,cells:h},W=c.find(J=>J.row==X.row);W&&r(1,c=c.filter(J=>J.row!==X.row)),W=c.find(J=>J.type==X.type),W&&r(1,c=c.filter(J=>J.type!==X.type)),r(1,c=[...c,X])}function _(){var X;r(2,g=[]);let i=c.find(W=>W.type==y.VARIABLE),b=c.find(W=>W.type==y.DATA);if(c.length>0){i||g.push("the variables still need to be marked"),b||g.push("the data still need to be marked");let W=0;for(let J=0;J<c.length;J++){const nt=c[J];console.log(J,nt);let ze=(X=nt.cells.filter(Be=>Be==!0))==null?void 0:X.length;if(J>0&&ze!=W){g.push("selection mismatch, the rows must have the same number of marked cells  ");break}W=ze}r(5,E=g.length==0)}else r(5,E=!1),r(2,g=[])}async function q(){if(r(4,$=!0),r(0,l.markers=c,l),l.entityId>0){console.log("save selection",l);let i=await Ul(l);console.log(i),i!=!1&&(console.log("selection",i),V("saved",l),r(4,$=!1))}else V("saved",l),r(4,$=!1)}function ne(){M(l.preview,String.fromCharCode(l.delimeter))}const F=i=>b=>{console.log(i,b.which,b.button),(b.which===1||b.button===0)&&(L(),console.log(i),Q(i),f=i),(b.which===3||b.button===2)&&L()};async function oe(i){const b=i;console.log("🚀 ~ e.detail:",i);const h=await il(l.file,l.entityId,b,0);r(0,l.preview=h.preview,l)}function De(i){e.$$.not_equal(l.delimeter,i)&&(l.delimeter=i,r(0,l))}function ie(i){e.$$.not_equal(l.decimal,i)&&(l.decimal=i,r(0,l))}function me(i){e.$$.not_equal(l.textMarker,i)&&(l.textMarker=i,r(0,l))}function xe(i){e.$$.not_equal(l.fileEncoding,i)&&(l.fileEncoding=i,r(0,l))}const et=()=>pe(y.VARIABLE),ve=()=>Ve.show("selectVar"),ke=()=>Ve.show("selectUnit"),tt=()=>pe(y.UNIT),Ae=()=>Ve.show("selectDescription"),_e=()=>pe(y.DESCRIPTION),Ie=()=>Ve.show("selectMissingValues"),je=()=>pe(y.MISSING_VALUES),lt=()=>Ve.show("selectData"),Le=()=>pe(y.DATA),Se=()=>Ve.show("resetSelection");function rt(i){e.$$.not_equal(l.missingValues,i)&&(l.missingValues=i,r(0,l))}const he=(i,b,h)=>h.row===i&&h.cells[b]===!0,le=(i,b,h)=>h.row===i&&h.cells[b]===!0,Te=(i,b,h)=>h.row===i&&h.cells[b]===!0,Me=(i,b,h)=>h.row===i&&h.cells[b]===!0,ct=(i,b,h)=>h.row===i&&h.cells[b]===!0;return e.$$set=i=>{"model"in i&&r(0,l=i.model),"init"in i&&r(18,n=i.init)},e.$$.update=()=>{e.$$.dirty[0]&1,e.$$.dirty[0]&2,e.$$.dirty[0]&4},[l,c,g,o,$,E,y,N,C,ee,H,K,be,pe,q,ne,F,oe,n,De,ie,me,xe,et,ve,ke,tt,Ae,_e,Ie,je,lt,Le,Se,rt,he,le,Te,Me,ct]}class nr extends $t{constructor(t){super(),yt(this,t,rr,tr,Et,{model:0,init:18},null,[-1,-1,-1])}}function sr(e){let t,r;return t=new Il({props:{error:e[14]}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p:at,i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){T(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function ar(e){let t,r,l=e[0]&&ll(e);return{c(){l&&l.c(),t=Ce()},l(n){l&&l.l(n),t=Ce()},m(n,a){l&&l.m(n,a),se(n,t,a),r=!0},p(n,a){n[0]?l?(l.p(n,a),a&1&&I(l,1)):(l=ll(n),l.c(),I(l,1),l.m(t.parentNode,t)):l&&(We(),T(l,1,1,()=>{l=null}),Ze())},i(n){r||(I(l),r=!0)},o(n){T(l),r=!1},d(n){n&&v(t),l&&l.d(n)}}}function ll(e){let t,r,l,n;const a=[ir,or],o=[];function c(s,d){return s[1]?0:s[0].variables?1:-1}return~(t=c(e))&&(r=o[t]=a[t](e)),{c(){r&&r.c(),l=Ce()},l(s){r&&r.l(s),l=Ce()},m(s,d){~t&&o[t].m(s,d),se(s,l,d),n=!0},p(s,d){let $=t;t=c(s),t===$?~t&&o[t].p(s,d):(r&&(We(),T(o[$],1,1,()=>{o[$]=null}),Ze()),~t?(r=o[t],r?r.p(s,d):(r=o[t]=a[t](s),r.c()),I(r,1),r.m(l.parentNode,l)):r=null)},i(s){n||(I(r),n=!0)},o(s){T(r),n=!1},d(s){s&&v(l),~t&&o[t].d(s)}}}function or(e){let t,r;return t=new Ql({props:{model:e[0]}}),t.$on("back",e[6]),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p(l,n){const a={};n&1&&(a.model=l[0]),t.$set(a)},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){T(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function ir(e){let t,r,l,n,a;function o(s){e[7](s)}let c={init:e[2]};return e[0]!==void 0&&(c.model=e[0]),r=new nr({props:c}),ye.push(()=>$e(r,"model",o)),r.$on("saved",e[5]),{c(){t=k("div"),j(r.$$.fragment)},l(s){t=w(s,"DIV",{});var d=S(t);z(r.$$.fragment,d),d.forEach(v)},m(s,d){se(s,t,d),G(r,t,null),a=!0},p(s,d){const $={};d&4&&($.init=s[2]),!l&&d&1&&(l=!0,$.model=s[0],Ee(()=>l=!1)),r.$set($)},i(s){a||(I(r.$$.fragment,s),s&&sl(()=>{a&&(n||(n=kt(t,wt,{},!0)),n.run(1))}),a=!0)},o(s){T(r.$$.fragment,s),s&&(n||(n=kt(t,wt,{},!1)),n.run(0)),a=!1},d(s){s&&v(t),Y(r),s&&n&&n.end()}}}function ur(e){let t,r;return t=new Mt({props:{label:e[3]}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p(l,n){const a={};n&8&&(a.label=l[3]),t.$set(a)},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){T(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function fr(e){let t,r,l={ctx:e,current:null,token:null,hasCatch:!0,pending:ur,then:ar,catch:sr,error:14,blocks:[,,,]};return El(e[4](),l),{c(){t=Ce(),l.block.c()},l(n){t=Ce(),l.block.l(n)},m(n,a){se(n,t,a),l.block.m(n,l.anchor=a),l.mount=()=>t.parentNode,l.anchor=t,r=!0},p(n,a){e=n,Cl(l,e,a)},i(n){r||(I(l.block),r=!0)},o(n){for(let a=0;a<3;a+=1){const o=l.blocks[a];T(o)}r=!1},d(n){n&&v(t),l.block.d(n),l.token=null,l=null}}}function cr(e){let t,r;return t=new bl({props:{title:"Data structure",note:"This page allows you to create and edit a selected data structure.",contentLayoutType:vl.full,help:!0,$$slots:{default:[fr]},$$scope:{ctx:e}}}),{c(){j(t.$$.fragment)},l(l){z(t.$$.fragment,l)},m(l,n){G(t,l,n),r=!0},p(l,[n]){const a={};n&32783&&(a.$$scope={dirty:n,ctx:l}),t.$set(a)},i(l){r||(I(t.$$.fragment,l),r=!0)},o(l){T(t.$$.fragment,l),r=!1},d(l){Y(t,l)}}}function dr(e,t,r){let l=Dl,n,a,o=0,c,s,d=!0,$=!0,f="the structure is loading";async function g(){var de,ge,Q,L,be;Ve.setHelpItemList(l),n=document.getElementById("datastructure"),a=Number(n==null?void 0:n.getAttribute("dataset")),Number(n==null?void 0:n.getAttribute("version")),c=""+(n==null?void 0:n.getAttribute("file")),o=Number(n==null?void 0:n.getAttribute("structure")),c&&r(3,f="the file "+c+" is currently being analyzed");const M=((de=n==null?void 0:n.getAttribute("isTemplateRequired"))==null?void 0:de.toLocaleLowerCase())=="true";Al.set(M);const B=((ge=n==null?void 0:n.getAttribute("isMeaningRequired"))==null?void 0:ge.toLocaleLowerCase())=="true";Ll.set(B);const N=((Q=n==null?void 0:n.getAttribute("setByTemplate"))==null?void 0:Q.toLocaleLowerCase())=="true";Ml.set(N);const C=((L=n==null?void 0:n.getAttribute("enforcePrimaryKey"))==null?void 0:L.toLocaleLowerCase())=="true";ol.set(C);const ee=((be=n==null?void 0:n.getAttribute("changeablePrimaryKey"))==null?void 0:be.toLocaleLowerCase())=="true";Bl.set(ee),console.log("🚀 ~ file: +page.svelte:69 ~ start ~ file:",c),c!=""?(console.log("file exist",c,a,0),r(0,s=await il(c,a,65001,0)),console.log("🚀 ~ start ~ model:",s)):o>0?(console.log("copy structure"),r(0,s=await Ol(o)),r(1,d=!1)):(console.log("empty structure"),r(0,s=await ql()),r(1,d=!1));const H=await Hl();Nl.set(H);const K=await Kl();Rl.set(K)}async function y(M){console.log("update",M.detail),r(0,s=M.detail);let B=await Fl(M.detail);B!=!1&&(r(0,s=B),r(1,d=!1))}function E(){r(1,d=!0),r(2,$=!1)}function V(M){s=M,r(0,s)}return e.$$.update=()=>{e.$$.dirty&1},[s,d,$,f,g,y,E,V]}class Cr extends $t{constructor(t){super(),yt(this,t,dr,cr,Et,{})}}export{Cr as component,Er as universal};
