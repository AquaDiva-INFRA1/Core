import{S as _e,i as he,f as X,c as E,a as P,m as S,t as f,g as x,b as m,e as ee,h as oe,d as T}from"../chunks/index.DYURmr33.js";import{F as se,c as Ve,d as Ae,g as ue,i as Le,n as fe,j as ce,a as $e,P as Ce,p as qe}from"../chunks/eslint4b.es.BLUuBmqK.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.CX43xlbX.js";import{s as ve,F as Y,e as O,j as z,c as j,b as U,d as k,l as G,a as A,i as J,m as w,v as te,G as Z,q as Ke,w as ke,H as Be,n as re,t as Fe,k as Ie,f as ae}from"../chunks/scheduler.CYFbRwgw.js";import{h as Ne,u as He,E as Re,S as De}from"../chunks/ErrorMessage.M_oOSnJZ.js";import{A as Me,V as Oe,a as ye,d as je}from"../chunks/help.BVYKNYvG.js";import{s as Ue,c as ze,g as Ge,a as Je,b as Qe}from"../chunks/services.CkTcXgKw.js";import{g as de}from"../chunks/BaseCaller.CX6_4FGJ.js";import{e as we,i as We,a as Xe,s as Ye,c as Ze,b as xe,d as et}from"../chunks/types.B8wc0Djk.js";function tt(){return{}}const yt=Object.freeze(Object.defineProperty({__proto__:null,load:tt},Symbol.toStringTag,{value:"Module"}));function me(r){let t,s,e,a,n;return s=new se({props:{icon:Le}}),{c(){t=O("button"),E(s.$$.fragment),this.h()},l(d){t=j(d,"BUTTON",{id:!0,title:!0,class:!0});var c=U(t);P(s.$$.fragment,c),c.forEach(k),this.h()},h(){A(t,"id","check"),A(t,"title","Check changed primary key against datasets that belong to the data structure."),A(t,"class","btn variant-filled-error text-xl")},m(d,c){J(d,t,c),S(s,t,null),e=!0,a||(n=[te(t,"mouseover",r[13]),te(t,"click",r[11])],a=!0)},p:re,i(d){e||(f(s.$$.fragment,d),e=!0)},o(d){m(s.$$.fragment,d),e=!1},d(d){d&&k(t),T(s),a=!1,ke(n)}}}function ge(r){let t,s;return t=new ye({props:{message:"please select a primary key",cssClass:"variant-filled-warning"}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){m(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function pe(r){let t,s;return t=new ye({props:{cssClass:"variant-filled-warning",$$slots:{default:[at]},$$scope:{ctx:r}}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){m(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function at(r){let t;return{c(){t=Fe("By selecting all variables as primary key, it is not possible to change lines during an update. At least one column must remain as a value.")},l(s){t=Ie(s,"By selecting all variables as primary key, it is not possible to change lines during an update. At least one column must remain as a value.")},m(s,e){J(s,t,e)},d(s){s&&k(t)}}}function st(r){let t,s,e,a,n,d,c,V,h,$,y,g,D,v,M,q,L,C,_,K,B,F,I,l,N;n=new se({props:{icon:Ve}});let o=r[7]&&!r[6]&&me(r);$=new se({props:{icon:Ae}});function Ee(i){r[14](i)}let ie={model:r[0]};r[3]!==void 0&&(ie.valid=r[3]),v=new Me({props:ie}),Y.push(()=>X(v,"valid",Ee));let p=r[8]&&r[0].variables.length>0&&r[5].length==0&&ge(),b=r[0].variables.length==r[5].length&&pe(r);function Pe(i){r[15](i)}function Se(i){r[16](i)}function Te(i){r[17](i)}let Q={dataExist:r[1],data:[]};return r[0].variables!==void 0&&(Q.variables=r[0].variables),r[2]!==void 0&&(Q.valid=r[2]),r[0].missingValues!==void 0&&(Q.missingValues=r[0].missingValues),_=new Oe({props:Q}),Y.push(()=>X(_,"variables",Pe)),Y.push(()=>X(_,"valid",Se)),Y.push(()=>X(_,"missingValues",Te)),{c(){t=O("div"),s=O("div"),e=O("div"),a=O("button"),E(n.$$.fragment),d=z(),c=O("div"),o&&o.c(),V=z(),h=O("button"),E($.$$.fragment),D=z(),E(v.$$.fragment),q=z(),p&&p.c(),L=z(),b&&b.c(),C=z(),E(_.$$.fragment),this.h()},l(i){t=j(i,"DIV",{});var u=U(t);s=j(u,"DIV",{class:!0});var H=U(s);e=j(H,"DIV",{class:!0});var R=U(e);a=j(R,"BUTTON",{title:!0,class:!0});var ne=U(a);P(n.$$.fragment,ne),ne.forEach(k),R.forEach(k),d=G(H),c=j(H,"DIV",{class:!0});var W=U(c);o&&o.l(W),V=G(W),h=j(W,"BUTTON",{title:!0,class:!0});var le=U(h);P($.$$.fragment,le),le.forEach(k),W.forEach(k),H.forEach(k),D=G(u),P(v.$$.fragment,u),q=G(u),p&&p.l(u),L=G(u),b&&b.l(u),C=G(u),P(_.$$.fragment,u),u.forEach(k),this.h()},h(){A(a,"title","back"),A(a,"class","btn variant-filled-warning"),A(e,"class","grow"),A(h,"title","save"),A(h,"class","btn variant-filled-primary text-xl"),h.disabled=y=!r[2]||!r[3]||!(r[8]&&r[4]||!r[8])||r[7]&&!r[6],A(c,"class","flex-none text-end"),A(s,"class","flex")},m(i,u){J(i,t,u),w(t,s),w(s,e),w(e,a),S(n,a,null),w(s,d),w(s,c),o&&o.m(c,null),w(c,V),w(c,h),S($,h,null),w(t,D),S(v,t,null),w(t,q),p&&p.m(t,null),w(t,L),b&&b.m(t,null),w(t,C),S(_,t,null),I=!0,l||(N=[te(a,"click",r[12]),te(h,"click",r[9])],l=!0)},p(i,[u]){i[7]&&!i[6]?o?(o.p(i,u),u&192&&f(o,1)):(o=me(i),o.c(),f(o,1),o.m(c,V)):o&&(x(),m(o,1,1,()=>{o=null}),ee()),(!I||u&220&&y!==(y=!i[2]||!i[3]||!(i[8]&&i[4]||!i[8])||i[7]&&!i[6]))&&(h.disabled=y);const H={};u&1&&(H.model=i[0]),!M&&u&8&&(M=!0,H.valid=i[3],Z(()=>M=!1)),v.$set(H),i[8]&&i[0].variables.length>0&&i[5].length==0?p?u&33&&f(p,1):(p=ge(),p.c(),f(p,1),p.m(t,L)):p&&(x(),m(p,1,1,()=>{p=null}),ee()),i[0].variables.length==i[5].length?b?u&33&&f(b,1):(b=pe(i),b.c(),f(b,1),b.m(t,C)):b&&(x(),m(b,1,1,()=>{b=null}),ee());const R={};u&2&&(R.dataExist=i[1]),!K&&u&1&&(K=!0,R.variables=i[0].variables,Z(()=>K=!1)),!B&&u&4&&(B=!0,R.valid=i[2],Z(()=>B=!1)),!F&&u&1&&(F=!0,R.missingValues=i[0].missingValues,Z(()=>F=!1)),_.$set(R)},i(i){I||(f(n.$$.fragment,i),f(o),f($.$$.fragment,i),i&&Ke(()=>{I&&(g||(g=oe(s,ue,{},!0)),g.run(1))}),f(v.$$.fragment,i),f(p),f(b),f(_.$$.fragment,i),I=!0)},o(i){m(n.$$.fragment,i),m(o),m($.$$.fragment,i),i&&(g||(g=oe(s,ue,{},!1)),g.run(0)),m(v.$$.fragment,i),m(p),m(b),m(_.$$.fragment,i),I=!1},d(i){i&&k(t),T(n),o&&o.d(),T($),i&&g&&g.end(),T(v),p&&p.d(),b&&b.d(),T(_),l=!1,ke(N)}}}function rt(r,t){if(r.length!==t.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!==t[s])return!1;return!0}function it(r,t,s){let e,a,{model:n}=t,{dataExist:d=!1}=t,c=!1,V=!1,h=Be(we),$=!1;const y=D();let g=y;function D(){var N;let l=[];return(N=n.variables)==null||N.forEach(o=>{o.isKey==!0&&(l=[...l,o.id])}),l}function v(){var N;s(5,g=[]);let l=!1;(N=n.variables)==null||N.forEach(o=>{o.isKey==!0&&(l=!0,s(5,g=[...g,o.id]))}),s(4,$=l),console.log("ðŸš€ ~ isPKSet:",$),s(7,e=!rt(y,g)),s(6,a=!e),console.log("ðŸš€ ~ pksHasChanged:",e,g,y)}async function M(){const l=await Ue(n);console.log("save",l),de("/rpm/datastructure")}function q(){de(document.referrer)}async function L(){console.log("ðŸš€ ~ currentPks:",g);const l=await ze(n.id,g);console.log("ðŸš€ ~ res:",l),s(6,a=l),a?fe.showNotification({notificationType:ce.success,message:"Primary key set is unique"}):fe.showNotification({notificationType:ce.error,message:"The selected primary key was checked against the existing data of the datasets and is not unique, therefore the structure cannot be saved."})}const C=()=>q(),_=()=>$e.show("check");function K(l){V=l,s(3,V)}function B(l){r.$$.not_equal(n.variables,l)&&(n.variables=l,s(0,n))}function F(l){c=l,s(2,c)}function I(l){r.$$.not_equal(n.missingValues,l)&&(n.missingValues=l,s(0,n))}return r.$$set=l=>{"model"in l&&s(0,n=l.model),"dataExist"in l&&s(1,d=l.dataExist)},r.$$.update=()=>{r.$$.dirty&1&&v()},s(7,e=!1),s(6,a=!1),[n,d,c,V,$,g,a,e,h,M,q,L,C,_,K,B,F,I]}class nt extends _e{constructor(t){super(),he(this,t,it,st,ve,{model:0,dataExist:1})}}function lt(r){let t,s;return t=new Re({props:{error:r[8]}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p:re,i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){m(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function ot(r){let t,s,e=r[0]&&be(r);return{c(){e&&e.c(),t=ae()},l(a){e&&e.l(a),t=ae()},m(a,n){e&&e.m(a,n),J(a,t,n),s=!0},p(a,n){a[0]?e?(e.p(a,n),n&1&&f(e,1)):(e=be(a),e.c(),f(e,1),e.m(t.parentNode,t)):e&&(x(),m(e,1,1,()=>{e=null}),ee())},i(a){s||(f(e),s=!0)},o(a){m(e),s=!1},d(a){a&&k(t),e&&e.d(a)}}}function be(r){let t,s;return t=new nt({props:{model:r[0],dataExist:r[1]}}),t.$on("back",r[3]),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p(e,a){const n={};a&1&&(n.model=e[0]),a&2&&(n.dataExist=e[1]),t.$set(n)},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){m(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function ut(r){let t,s;return t=new De({props:{label:"the structure is loading"}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p:re,i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){m(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function ft(r){let t,s,e={ctx:r,current:null,token:null,hasCatch:!0,pending:ut,then:ot,catch:lt,error:8,blocks:[,,,]};return Ne(r[2](),e),{c(){t=ae(),e.block.c()},l(a){t=ae(),e.block.l(a)},m(a,n){J(a,t,n),e.block.m(a,e.anchor=n),e.mount=()=>t.parentNode,e.anchor=t,s=!0},p(a,n){r=a,He(e,r,n)},i(a){s||(f(e.block),s=!0)},o(a){for(let n=0;n<3;n+=1){const d=e.blocks[n];m(d)}s=!1},d(a){a&&k(t),e.block.d(a),e.token=null,e=null}}}function ct(r){let t,s;return t=new Ce({props:{title:"Data structure",note:"This page allows you to create and edit data structures.",contentLayoutType:qe.full,help:!0,$$slots:{default:[ft]},$$scope:{ctx:r}}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p(e,[a]){const n={};a&515&&(n.$$scope={dirty:a,ctx:e}),t.$set(n)},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){m(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function dt(r,t,s){let e=je,a,n=0,d,c=!1;async function V(){var L,C,_,K,B,F;$e.setHelpItemList(e),a=document.getElementById("datastructure"),n=Number(a==null?void 0:a.getAttribute("structure")),s(1,c=((L=a==null?void 0:a.getAttribute("dataExist"))==null?void 0:L.toLocaleLowerCase())==="true"),console.log("ðŸš€ ~ file: +page.svelte:32 ~ start ~ container?.getAttribute('dataExist'):",a==null?void 0:a.getAttribute("dataExist")),console.log("ðŸš€ ~ file: +page.svelte:32 ~ start ~ dataExist:",c);const $=((C=a==null?void 0:a.getAttribute("isTemplateRequired"))==null?void 0:C.toLocaleLowerCase())=="true";We.set($);const y=((_=a==null?void 0:a.getAttribute("isMeaningRequired"))==null?void 0:_.toLocaleLowerCase())=="true";console.log("ðŸš€ ~ file: +page.svelte:57 ~ start ~ isMeaningRequired:",y),Xe.set(y);const g=((K=a==null?void 0:a.getAttribute("setByTemplate"))==null?void 0:K.toLocaleLowerCase())=="true";Ye.set(g);const D=((B=a==null?void 0:a.getAttribute("enforcePrimaryKey"))==null?void 0:B.toLocaleLowerCase())=="true";we.set(D);const v=((F=a==null?void 0:a.getAttribute("changeablePrimaryKey"))==null?void 0:F.toLocaleLowerCase())=="true";Ze.set(v),console.log("edit structure",n),s(0,d=await Ge(n));const M=await Je();xe.set(M);const q=await Qe();et.set(q)}function h(){}return r.$$.update=()=>{r.$$.dirty&1},[d,c,V,h]}class wt extends _e{constructor(t){super(),he(this,t,dt,ct,ve,{})}}export{wt as component,yt as universal};
