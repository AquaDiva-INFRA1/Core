import{s as _e,F as X,e as O,l as Q,c as U,h as j,d as k,o as z,a as A,i as G,p as w,x as te,P as Y,H as Ve,B as he,Q as Ae,n as re,t as Le,m as Ce,j as ae}from"../chunks/scheduler.BD3IPErK.js";import{h as qe,u as Ke,E as Be,S as Fe}from"../chunks/ErrorMessage.C_-DmavX.js";import{S as $e,i as ve,f as Z,c as E,a as P,m as S,t as f,g as x,b as d,e as ee,h as oe,d as T}from"../chunks/index.CufQnT-K.js";import{F as se,b as Ie,c as Ne,d as ue,g as He,P as Re}from"../chunks/Page.DNGIaKrR.js";import{n as fe,b as ce,a as ke,p as De}from"../chunks/eslint4b.es.C89pjaTy.js";import{A as Me,V as Oe,a as ye,d as Ue}from"../chunks/help.CK8EdFW0.js";import{s as je,c as Qe,g as ze,a as Ge,b as Je}from"../chunks/services.aNeUta1w.js";import{g as me}from"../chunks/BaseCaller.BYNhd9sz.js";import{e as we,i as We,a as Xe,s as Ye,c as Ze,b as xe,d as et}from"../chunks/types.BRsl5xZG.js";function de(r){let t,s,e,a,i;return s=new se({props:{icon:He}}),{c(){t=O("button"),E(s.$$.fragment),this.h()},l(m){t=U(m,"BUTTON",{id:!0,title:!0,class:!0});var c=j(t);P(s.$$.fragment,c),c.forEach(k),this.h()},h(){A(t,"id","check"),A(t,"title","Check changed primary key against datasets that belong to the data structure."),A(t,"class","btn variant-filled-error text-xl")},m(m,c){G(m,t,c),S(s,t,null),e=!0,a||(i=[te(t,"mouseover",r[13]),te(t,"click",r[11])],a=!0)},p:re,i(m){e||(f(s.$$.fragment,m),e=!0)},o(m){d(s.$$.fragment,m),e=!1},d(m){m&&k(t),T(s),a=!1,he(i)}}}function ge(r){let t,s;return t=new ye({props:{message:"please select a primary key",cssClass:"variant-filled-warning"}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){d(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function pe(r){let t,s;return t=new ye({props:{cssClass:"variant-filled-warning",$$slots:{default:[tt]},$$scope:{ctx:r}}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){d(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function tt(r){let t;return{c(){t=Le(`By selecting all variables as primary key, it is not possible to change lines during an
			update. At least one column must remain as a value.`)},l(s){t=Ce(s,`By selecting all variables as primary key, it is not possible to change lines during an
			update. At least one column must remain as a value.`)},m(s,e){G(s,t,e)},d(s){s&&k(t)}}}function at(r){let t,s,e,a,i,m,c,V,h,$,y,g,D,v,M,q,L,C,_,K,B,F,I,l,N;i=new se({props:{icon:Ie}});let o=r[7]&&!r[6]&&de(r);$=new se({props:{icon:Ne}});function Ee(n){r[14](n)}let ne={model:r[0]};r[3]!==void 0&&(ne.valid=r[3]),v=new Me({props:ne}),X.push(()=>Z(v,"valid",Ee));let p=r[8]&&r[0].variables.length>0&&r[5].length==0&&ge(),b=r[0].variables.length==r[5].length&&pe(r);function Pe(n){r[15](n)}function Se(n){r[16](n)}function Te(n){r[17](n)}let J={dataExist:r[1],data:[]};return r[0].variables!==void 0&&(J.variables=r[0].variables),r[2]!==void 0&&(J.valid=r[2]),r[0].missingValues!==void 0&&(J.missingValues=r[0].missingValues),_=new Oe({props:J}),X.push(()=>Z(_,"variables",Pe)),X.push(()=>Z(_,"valid",Se)),X.push(()=>Z(_,"missingValues",Te)),{c(){t=O("div"),s=O("div"),e=O("div"),a=O("button"),E(i.$$.fragment),m=Q(),c=O("div"),o&&o.c(),V=Q(),h=O("button"),E($.$$.fragment),D=Q(),E(v.$$.fragment),q=Q(),p&&p.c(),L=Q(),b&&b.c(),C=Q(),E(_.$$.fragment),this.h()},l(n){t=U(n,"DIV",{});var u=j(t);s=U(u,"DIV",{class:!0});var H=j(s);e=U(H,"DIV",{class:!0});var R=j(e);a=U(R,"BUTTON",{title:!0,class:!0});var ie=j(a);P(i.$$.fragment,ie),ie.forEach(k),R.forEach(k),m=z(H),c=U(H,"DIV",{class:!0});var W=j(c);o&&o.l(W),V=z(W),h=U(W,"BUTTON",{title:!0,class:!0});var le=j(h);P($.$$.fragment,le),le.forEach(k),W.forEach(k),H.forEach(k),D=z(u),P(v.$$.fragment,u),q=z(u),p&&p.l(u),L=z(u),b&&b.l(u),C=z(u),P(_.$$.fragment,u),u.forEach(k),this.h()},h(){A(a,"title","back"),A(a,"class","btn variant-filled-warning"),A(e,"class","grow"),A(h,"title","save"),A(h,"class","btn variant-filled-primary text-xl"),h.disabled=y=!r[2]||!r[3]||!(r[8]&&r[4]||!r[8])||r[7]&&!r[6],A(c,"class","flex-none text-end"),A(s,"class","flex")},m(n,u){G(n,t,u),w(t,s),w(s,e),w(e,a),S(i,a,null),w(s,m),w(s,c),o&&o.m(c,null),w(c,V),w(c,h),S($,h,null),w(t,D),S(v,t,null),w(t,q),p&&p.m(t,null),w(t,L),b&&b.m(t,null),w(t,C),S(_,t,null),I=!0,l||(N=[te(a,"click",r[12]),te(h,"click",r[9])],l=!0)},p(n,[u]){n[7]&&!n[6]?o?(o.p(n,u),u&192&&f(o,1)):(o=de(n),o.c(),f(o,1),o.m(c,V)):o&&(x(),d(o,1,1,()=>{o=null}),ee()),(!I||u&220&&y!==(y=!n[2]||!n[3]||!(n[8]&&n[4]||!n[8])||n[7]&&!n[6]))&&(h.disabled=y);const H={};u&1&&(H.model=n[0]),!M&&u&8&&(M=!0,H.valid=n[3],Y(()=>M=!1)),v.$set(H),n[8]&&n[0].variables.length>0&&n[5].length==0?p?u&33&&f(p,1):(p=ge(),p.c(),f(p,1),p.m(t,L)):p&&(x(),d(p,1,1,()=>{p=null}),ee()),n[0].variables.length==n[5].length?b?u&33&&f(b,1):(b=pe(n),b.c(),f(b,1),b.m(t,C)):b&&(x(),d(b,1,1,()=>{b=null}),ee());const R={};u&2&&(R.dataExist=n[1]),!K&&u&1&&(K=!0,R.variables=n[0].variables,Y(()=>K=!1)),!B&&u&4&&(B=!0,R.valid=n[2],Y(()=>B=!1)),!F&&u&1&&(F=!0,R.missingValues=n[0].missingValues,Y(()=>F=!1)),_.$set(R)},i(n){I||(f(i.$$.fragment,n),f(o),f($.$$.fragment,n),n&&Ve(()=>{I&&(g||(g=oe(s,ue,{},!0)),g.run(1))}),f(v.$$.fragment,n),f(p),f(b),f(_.$$.fragment,n),I=!0)},o(n){d(i.$$.fragment,n),d(o),d($.$$.fragment,n),n&&(g||(g=oe(s,ue,{},!1)),g.run(0)),d(v.$$.fragment,n),d(p),d(b),d(_.$$.fragment,n),I=!1},d(n){n&&k(t),T(i),o&&o.d(),T($),n&&g&&g.end(),T(v),p&&p.d(),b&&b.d(),T(_),l=!1,he(N)}}}function st(r,t){if(r.length!==t.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!==t[s])return!1;return!0}function rt(r,t,s){let e,a,{model:i}=t,{dataExist:m=!1}=t,c=!1,V=!1,h=Ae(we),$=!1;const y=D();let g=y;function D(){var N;let l=[];return(N=i.variables)==null||N.forEach(o=>{o.isKey==!0&&(l=[...l,o.id])}),l}function v(){var N;s(5,g=[]);let l=!1;(N=i.variables)==null||N.forEach(o=>{o.isKey==!0&&(l=!0,s(5,g=[...g,o.id]))}),s(4,$=l),console.log("ðŸš€ ~ isPKSet:",$),s(7,e=!st(y,g)),s(6,a=!e),console.log("ðŸš€ ~ pksHasChanged:",e,g,y)}async function M(){const l=await je(i);console.log("save",l),console.log("ðŸš€ ~ back ~ goTo(document.referrer);:",document.referrer),me(document.referrer)}function q(){me(document.referrer)}async function L(){console.log("ðŸš€ ~ currentPks:",g);const l=await Qe(i.id,g);console.log("ðŸš€ ~ res:",l),s(6,a=l),a?fe.showNotification({notificationType:ce.success,message:"Primary key set is unique"}):fe.showNotification({notificationType:ce.error,message:"The selected primary key was checked against the existing data of the datasets and is not unique, therefore the structure cannot be saved."})}const C=()=>q(),_=()=>ke.show("check");function K(l){V=l,s(3,V)}function B(l){r.$$.not_equal(i.variables,l)&&(i.variables=l,s(0,i))}function F(l){c=l,s(2,c)}function I(l){r.$$.not_equal(i.missingValues,l)&&(i.missingValues=l,s(0,i))}return r.$$set=l=>{"model"in l&&s(0,i=l.model),"dataExist"in l&&s(1,m=l.dataExist)},r.$$.update=()=>{r.$$.dirty&1&&v()},s(7,e=!1),s(6,a=!1),[i,m,c,V,$,g,a,e,h,M,q,L,C,_,K,B,F,I]}class nt extends $e{constructor(t){super(),ve(this,t,rt,at,_e,{model:0,dataExist:1})}}function it(r){let t,s;return t=new Be({props:{error:r[8]}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p:re,i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){d(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function lt(r){let t,s,e=r[0]&&be(r);return{c(){e&&e.c(),t=ae()},l(a){e&&e.l(a),t=ae()},m(a,i){e&&e.m(a,i),G(a,t,i),s=!0},p(a,i){a[0]?e?(e.p(a,i),i&1&&f(e,1)):(e=be(a),e.c(),f(e,1),e.m(t.parentNode,t)):e&&(x(),d(e,1,1,()=>{e=null}),ee())},i(a){s||(f(e),s=!0)},o(a){d(e),s=!1},d(a){a&&k(t),e&&e.d(a)}}}function be(r){let t,s;return t=new nt({props:{model:r[0],dataExist:r[1]}}),t.$on("back",r[3]),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p(e,a){const i={};a&1&&(i.model=e[0]),a&2&&(i.dataExist=e[1]),t.$set(i)},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){d(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function ot(r){let t,s;return t=new Fe({props:{label:"the structure is loading"}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p:re,i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){d(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function ut(r){let t,s,e={ctx:r,current:null,token:null,hasCatch:!0,pending:ot,then:lt,catch:it,error:8,blocks:[,,,]};return qe(r[2](),e),{c(){t=ae(),e.block.c()},l(a){t=ae(),e.block.l(a)},m(a,i){G(a,t,i),e.block.m(a,e.anchor=i),e.mount=()=>t.parentNode,e.anchor=t,s=!0},p(a,i){r=a,Ke(e,r,i)},i(a){s||(f(e.block),s=!0)},o(a){for(let i=0;i<3;i+=1){const m=e.blocks[i];d(m)}s=!1},d(a){a&&k(t),e.block.d(a),e.token=null,e=null}}}function ft(r){let t,s;return t=new Re({props:{title:"Data structure",note:"This page allows you to create and edit data structures.",contentLayoutType:De.full,help:!0,$$slots:{default:[ut]},$$scope:{ctx:r}}}),{c(){E(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,a){S(t,e,a),s=!0},p(e,[a]){const i={};a&515&&(i.$$scope={dirty:a,ctx:e}),t.$set(i)},i(e){s||(f(t.$$.fragment,e),s=!0)},o(e){d(t.$$.fragment,e),s=!1},d(e){T(t,e)}}}function ct(r,t,s){let e=Ue,a,i=0,m,c=!1;async function V(){var L,C,_,K,B,F;ke.setHelpItemList(e),a=document.getElementById("datastructure"),i=Number(a==null?void 0:a.getAttribute("structure")),s(1,c=((L=a==null?void 0:a.getAttribute("dataExist"))==null?void 0:L.toLocaleLowerCase())==="true"),console.log("ðŸš€ ~ file: +page.svelte:32 ~ start ~ container?.getAttribute('dataExist'):",a==null?void 0:a.getAttribute("dataExist")),console.log("ðŸš€ ~ file: +page.svelte:32 ~ start ~ dataExist:",c);const $=((C=a==null?void 0:a.getAttribute("isTemplateRequired"))==null?void 0:C.toLocaleLowerCase())=="true";We.set($);const y=((_=a==null?void 0:a.getAttribute("isMeaningRequired"))==null?void 0:_.toLocaleLowerCase())=="true";console.log("ðŸš€ ~ file: +page.svelte:57 ~ start ~ isMeaningRequired:",y),Xe.set(y);const g=((K=a==null?void 0:a.getAttribute("setByTemplate"))==null?void 0:K.toLocaleLowerCase())=="true";Ye.set(g);const D=((B=a==null?void 0:a.getAttribute("enforcePrimaryKey"))==null?void 0:B.toLocaleLowerCase())=="true";we.set(D);const v=((F=a==null?void 0:a.getAttribute("changeablePrimaryKey"))==null?void 0:F.toLocaleLowerCase())=="true";Ze.set(v),console.log("edit structure",i),s(0,m=await ze(i));const M=await Ge();xe.set(M);const q=await Je();et.set(q)}function h(){}return r.$$.update=()=>{r.$$.dirty&1},[m,c,V,h]}class kt extends $e{constructor(t){super(),ve(this,t,ct,ft,_e,{})}}export{kt as component};
