import{s as Ct,F as ye,e as $,l as N,c as y,h as V,d as w,o as R,a as m,i as ne,p as f,x as q,P as Ee,H as rl,B as Mt,R as nl,Q as _l,g as $e,n as ft,j as Te,S as hl,N as bl,t as ct,m as dt,L as vl,q as gt,k as Lt,I as ge}from"../chunks/scheduler.BD3IPErK.js";import{S as Bt,h as kl,u as wl,E as $l}from"../chunks/ErrorMessage.C_-DmavX.js";import{S as Tt,i as It,f as Ce,c as G,a as z,m as W,t as I,g as et,b as D,e as tt,h as yt,d as Y}from"../chunks/index.CufQnT-K.js";import{F as xe,b as sl,c as al,d as Et,i as yl,e as Ze,j as El,P as Cl}from"../chunks/Page.DNGIaKrR.js";import{a as Ae,j as ol,p as Tl}from"../chunks/eslint4b.es.C89pjaTy.js";import{A as Il,V as Vl,a as Dl,d as Sl}from"../chunks/help.CK8EdFW0.js";import{e as il,i as Al,a as Ll,s as Ml,c as Bl,b as Nl,d as Rl}from"../chunks/types.BRsl5xZG.js";import{d as Pl,e as Ul,l as ul,f as Ol,h as ql,a as Hl,b as Fl,i as Kl}from"../chunks/services.aNeUta1w.js";import{g as $t}from"../chunks/BaseCaller.BYNhd9sz.js";import{D as wt}from"../chunks/DropdownKvP.v2F58Eld.js";import{M as jl}from"../chunks/MissingValues.CumlbGyG.js";function Qt(e){let l,r;return l=new Dl({props:{message:"please select a primary key",cssClass:"variant-filled-warning"}}),{c(){G(l.$$.fragment)},l(t){z(l.$$.fragment,t)},m(t,n){W(l,t,n),r=!0},i(t){r||(I(l.$$.fragment,t),r=!0)},o(t){D(l.$$.fragment,t),r=!1},d(t){Y(l,t)}}}function Gl(e){let l,r,t,n,s,o,c,a,_,E,u,g,d,h,T,P,L,M,C,le,K,Q,he;s=new xe({props:{icon:sl}}),_=new xe({props:{icon:al}});function be(b){e[11](b)}let J={model:e[0]};e[2]!==void 0&&(J.valid=e[2]),d=new Il({props:J}),ye.push(()=>Ce(d,"valid",be));let B=e[4]&&e[0].variables.length>0&&!e[3]&&Qt();function pe(b){e[12](b)}function x(b){e[13](b)}function Ge(b){e[14](b)}let ve={data:e[6]()};return e[0].variables!==void 0&&(ve.variables=e[0].variables),e[1]!==void 0&&(ve.valid=e[1]),e[0].missingValues!==void 0&&(ve.missingValues=e[0].missingValues),L=new Vl({props:ve}),ye.push(()=>Ce(L,"variables",pe)),ye.push(()=>Ce(L,"valid",x)),ye.push(()=>Ce(L,"missingValues",Ge)),{c(){l=$("div"),r=$("div"),t=$("div"),n=$("button"),G(s.$$.fragment),o=N(),c=$("div"),a=$("button"),G(_.$$.fragment),g=N(),G(d.$$.fragment),T=N(),B&&B.c(),P=N(),G(L.$$.fragment),this.h()},l(b){l=y(b,"DIV",{});var U=V(l);r=y(U,"DIV",{class:!0});var re=V(r);t=y(re,"DIV",{class:!0});var X=V(t);n=y(X,"BUTTON",{id:!0,title:!0,class:!0});var ie=V(n);z(s.$$.fragment,ie),ie.forEach(w),X.forEach(w),o=R(re),c=y(re,"DIV",{class:!0});var Le=V(c);a=y(Le,"BUTTON",{id:!0,title:!0,class:!0});var ue=V(a);z(_.$$.fragment,ue),ue.forEach(w),Le.forEach(w),re.forEach(w),g=R(U),z(d.$$.fragment,U),T=R(U),B&&B.l(U),P=R(U),z(L.$$.fragment,U),U.forEach(w),this.h()},h(){m(n,"id","back"),m(n,"title","back"),m(n,"class","btn variant-filled-warning"),m(t,"class","grow"),m(a,"id","save"),m(a,"title","save"),m(a,"class","btn variant-filled-primary text-xl"),a.disabled=E=!e[1]||!e[2]||!(e[4]&&e[3]||!e[4]),m(c,"class","flex-none text-end"),m(r,"class","flex")},m(b,U){ne(b,l,U),f(l,r),f(r,t),f(t,n),W(s,n,null),f(r,o),f(r,c),f(c,a),W(_,a,null),f(l,g),W(d,l,null),f(l,T),B&&B.m(l,null),f(l,P),W(L,l,null),K=!0,Q||(he=[q(n,"mouseover",e[8]),q(n,"click",e[9]),q(a,"mouseover",e[10]),q(a,"click",e[5])],Q=!0)},p(b,[U]){(!K||U&14&&E!==(E=!b[1]||!b[2]||!(b[4]&&b[3]||!b[4])))&&(a.disabled=E);const re={};U&1&&(re.model=b[0]),!h&&U&4&&(h=!0,re.valid=b[2],Ee(()=>h=!1)),d.$set(re),b[4]&&b[0].variables.length>0&&!b[3]?B?U&9&&I(B,1):(B=Qt(),B.c(),I(B,1),B.m(l,P)):B&&(et(),D(B,1,1,()=>{B=null}),tt());const X={};!M&&U&1&&(M=!0,X.variables=b[0].variables,Ee(()=>M=!1)),!C&&U&2&&(C=!0,X.valid=b[1],Ee(()=>C=!1)),!le&&U&1&&(le=!0,X.missingValues=b[0].missingValues,Ee(()=>le=!1)),L.$set(X)},i(b){K||(I(s.$$.fragment,b),I(_.$$.fragment,b),b&&rl(()=>{K&&(u||(u=yt(r,Et,{},!0)),u.run(1))}),I(d.$$.fragment,b),I(B),I(L.$$.fragment,b),K=!0)},o(b){D(s.$$.fragment,b),D(_.$$.fragment,b),b&&(u||(u=yt(r,Et,{},!1)),u.run(0)),D(d.$$.fragment,b),D(B),D(L.$$.fragment,b),K=!1},d(b){b&&w(l),Y(s),Y(_),b&&u&&u.end(),Y(d),B&&B.d(),Y(L),Q=!1,Mt(he)}}}function zl(e,l,r){let t,n=!1,s=!1;nl();let{model:o}=l,c=_l(il);function a(){var le;let C=!1;(le=o.variables)==null||le.forEach(K=>{K.isKey==!0&&(C=!0)}),r(3,t=C)}async function _(){const C=await Pl(o);console.log("save",C),o.entityId>0?$t("/dcm/edit?id="+o.entityId):$t("/rpm/datastructure")}function E(){let C=[];if(o&&o.markers){const le=o.markers.find(K=>K.type=="data");if(le)for(let K=le.row;K<o.preview.length;K++){const Q=o.preview[K];C.push(Q.split(String.fromCharCode(o.delimeter)))}}return C}function u(){$t(document.referrer)}const g=()=>Ae.show("back"),d=()=>u(),h=()=>Ae.show("save");function T(C){s=C,r(2,s)}function P(C){e.$$.not_equal(o.variables,C)&&(o.variables=C,r(0,o))}function L(C){n=C,r(1,n)}function M(C){e.$$.not_equal(o.missingValues,C)&&(o.missingValues=C,r(0,o))}return e.$$set=C=>{"model"in C&&r(0,o=C.model)},e.$$.update=()=>{e.$$.dirty&1&&a()},r(3,t=!1),[o,n,s,t,c,_,E,u,g,d,h,T,P,L,M]}class Wl extends Tt{constructor(l){super(),It(this,l,zl,Gl,Ct,{model:0})}}function Yl(e){let l,r='<h4 class="h4">Controls</h4> <hr class="divide-x-8"/> <dl class="list-dl gap-0"><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Selection</dt> <dd>left mouse button</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Drag</dt> <dd>left mouse button down and drag</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Deselect</dt> <dd>right mouse button click</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Select Row</dt> <dd>double click left mouse button or click arrow</dd></span> </div><div><span class="badge bg-primary-500"></span> <span class="flex-auto"><dt class="font-bold">Deselect Row</dt> <dd>right mouse button click on arrow</dd></span></div></dl>';return{c(){l=$("div"),l.innerHTML=r,this.h()},l(t){l=y(t,"DIV",{class:!0,"data-svelte-h":!0}),$e(l)!=="svelte-1p56ohu"&&(l.innerHTML=r),this.h()},h(){m(l,"class","col-span-1 card p-5 text-sm")},m(t,n){ne(t,l,n)},p:ft,i:ft,o:ft,d(t){t&&w(l)}}}class Ql extends Tt{constructor(l){super(),It(this,l,null,Yl,Ct,{})}}function Xt(e,l,r){const t=e.slice();return t[61]=l[r],t[63]=r,t}function Jt(e,l,r){const t=e.slice();return t[64]=l[r],t[66]=r,t}function Zt(e,l,r){const t=e.slice();return t[67]=l[r],t}function Xl(e){let l,r,t,n,s,o,c,a,_,E,u,g,d,h,T,P,L,M,C,le="Variable",K,Q,he="Unit",be,J,B="Description",pe,x,Ge="Missing Values",ve,b,U="Data",re,X,ie,Le,ue,fe,ze,lt,ke,we,rt,Me,me,Ie,We,nt,Be,Ve,st,_e,se,De,Ne,pt="Total:",at,qe=e[0].total+"",Ye,ot,Se,i,k="Found:",p,O=e[0].total-e[0].skipped+"",F,j,oe,Z,it="Skipped:",Vt,ut=e[0].skipped+"",mt,Dt,He,Nt="<i>you see only the first 10 rows of the data</i>",St,Qe,Fe,Xe,Re,At,Rt;function fl(v){e[22](v)}let Pt={id:"delimeter",title:"Delimeter",source:e[0].delimeters,complexTarget:!1,help:!0};e[0].delimeter!==void 0&&(Pt.target=e[0].delimeter),o=new wt({props:Pt}),ye.push(()=>Ce(o,"target",fl)),o.$on("change",e[16]);function cl(v){e[23](v)}let Ut={id:"decimal",title:"Decimal",source:e[0].decimals,complexTarget:!1,help:!0};e[0].decimal!==void 0&&(Ut.target=e[0].decimal),_=new wt({props:Ut}),ye.push(()=>Ce(_,"target",cl));function dl(v){e[24](v)}let Ot={id:"textMarker",title:"TextMarker",source:e[0].textMarkers,complexTarget:!1,help:!0};e[0].textMarker!==void 0&&(Ot.target=e[0].textMarker),g=new wt({props:Ot}),ye.push(()=>Ce(g,"target",dl));function gl(v){e[25](v)}let qt={id:"encoding",title:"Encoding",source:e[0].encodings,complexTarget:!1,help:!0};e[0].fileEncoding!==void 0&&(qt.target=e[0].fileEncoding),T=new wt({props:qt}),ye.push(()=>Ce(T,"target",gl)),T.$on("change",function(){bl(e[18](e[0].fileEncoding))&&e[18](e[0].fileEncoding).apply(this,arguments)}),ie=new xe({props:{icon:yl}});function pl(v){e[37](v)}let Ht={};e[0].missingValues!==void 0&&(Ht.list=e[0].missingValues),fe=new jl({props:Ht}),ye.push(()=>Ce(fe,"list",pl));let Je=Ze(e[3]),te=[];for(let v=0;v<Je.length;v+=1)te[v]=xt(Zt(e,Je,v));Ie=new xe({props:{icon:al}}),Ve=new Ql({});let Ke=Ze(e[2]),H=[];for(let v=0;v<Ke.length;v+=1)H[v]=tl(Xt(e,Ke,v));const ml=v=>D(H[v],1,1,()=>{H[v]=null});return{c(){l=$("form"),r=$("div"),t=$("div"),n=$("div"),s=$("div"),G(o.$$.fragment),a=N(),G(_.$$.fragment),u=N(),G(g.$$.fragment),h=N(),G(T.$$.fragment),L=N(),M=$("div"),C=$("button"),C.textContent=le,K=N(),Q=$("button"),Q.textContent=he,be=N(),J=$("button"),J.textContent=B,pe=N(),x=$("button"),x.textContent=Ge,ve=N(),b=$("button"),b.textContent=U,re=N(),X=$("button"),G(ie.$$.fragment),Le=N(),ue=$("div"),G(fe.$$.fragment),lt=N(),ke=$("div"),we=$("div");for(let v=0;v<te.length;v+=1)te[v].c();rt=N(),Me=$("div"),me=$("button"),G(Ie.$$.fragment),nt=N(),Be=$("div"),G(Ve.$$.fragment),st=N(),_e=$("div"),se=$("div"),De=$("label"),Ne=$("b"),Ne.textContent=pt,at=N(),Ye=ct(qe),ot=N(),Se=$("label"),i=$("b"),i.textContent=k,p=N(),F=ct(O),j=N(),oe=$("label"),Z=$("b"),Z.textContent=it,Vt=N(),mt=ct(ut),Dt=N(),He=$("label"),He.innerHTML=Nt,St=N(),Qe=$("div"),Fe=$("table"),Xe=$("tbody");for(let v=0;v<H.length;v+=1)H[v].c();this.h()},l(v){l=y(v,"FORM",{});var A=V(l);r=y(A,"DIV",{id:!0,class:!0});var ee=V(r);t=y(ee,"DIV",{class:!0});var Pe=V(t);n=y(Pe,"DIV",{id:!0,class:!0});var ce=V(n);s=y(ce,"DIV",{id:!0,class:!0});var de=V(s);z(o.$$.fragment,de),a=R(de),z(_.$$.fragment,de),u=R(de),z(g.$$.fragment,de),h=R(de),z(T.$$.fragment,de),de.forEach(w),L=R(ce),M=y(ce,"DIV",{id:!0,class:!0});var ae=V(M);C=y(ae,"BUTTON",{class:!0,id:!0,type:!0,"data-svelte-h":!0}),$e(C)!=="svelte-1th9q8m"&&(C.textContent=le),K=R(ae),Q=y(ae,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),$e(Q)!=="svelte-1uhcbun"&&(Q.textContent=he),be=R(ae),J=y(ae,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),$e(J)!=="svelte-6f54j6"&&(J.textContent=B),pe=R(ae),x=y(ae,"BUTTON",{class:!0,type:!0,color:!0,id:!0,"data-svelte-h":!0}),$e(x)!=="svelte-1v4zuqe"&&(x.textContent=Ge),ve=R(ae),b=y(ae,"BUTTON",{class:!0,type:!0,id:!0,"data-svelte-h":!0}),$e(b)!=="svelte-pjfsfy"&&(b.textContent=U),re=R(ae),X=y(ae,"BUTTON",{title:!0,id:!0,class:!0,type:!0});var S=V(X);z(ie.$$.fragment,S),S.forEach(w),ae.forEach(w),Le=R(ce),ue=y(ce,"DIV",{id:!0,class:!0});var Ue=V(ue);z(fe.$$.fragment,Ue),Ue.forEach(w),lt=R(ce),ke=y(ce,"DIV",{class:!0});var _t=V(ke);we=y(_t,"DIV",{id:!0,class:!0});var Ft=V(we);for(let je=0;je<te.length;je+=1)te[je].l(Ft);Ft.forEach(w),rt=R(_t),Me=y(_t,"DIV",{class:!0});var Kt=V(Me);me=y(Kt,"BUTTON",{title:!0,class:!0});var jt=V(me);z(Ie.$$.fragment,jt),jt.forEach(w),Kt.forEach(w),_t.forEach(w),ce.forEach(w),nt=R(Pe),Be=y(Pe,"DIV",{class:!0});var Gt=V(Be);z(Ve.$$.fragment,Gt),Gt.forEach(w),Pe.forEach(w),st=R(ee),_e=y(ee,"DIV",{id:!0,class:!0});var ht=V(_e);se=y(ht,"DIV",{id:!0,class:!0});var Oe=V(se);De=y(Oe,"LABEL",{});var bt=V(De);Ne=y(bt,"B",{"data-svelte-h":!0}),$e(Ne)!=="svelte-sykk0o"&&(Ne.textContent=pt),at=R(bt),Ye=dt(bt,qe),bt.forEach(w),ot=R(Oe),Se=y(Oe,"LABEL",{});var vt=V(Se);i=y(vt,"B",{"data-svelte-h":!0}),$e(i)!=="svelte-5ox7e6"&&(i.textContent=k),p=R(vt),F=dt(vt,O),vt.forEach(w),j=R(Oe),oe=y(Oe,"LABEL",{});var kt=V(oe);Z=y(kt,"B",{"data-svelte-h":!0}),$e(Z)!=="svelte-1pbimz2"&&(Z.textContent=it),Vt=R(kt),mt=dt(kt,ut),kt.forEach(w),Dt=R(Oe),He=y(Oe,"LABEL",{class:!0,"data-svelte-h":!0}),$e(He)!=="svelte-klacyg"&&(He.innerHTML=Nt),Oe.forEach(w),St=R(ht),Qe=y(ht,"DIV",{class:!0});var zt=V(Qe);Fe=y(zt,"TABLE",{class:!0});var Wt=V(Fe);Xe=y(Wt,"TBODY",{});var Yt=V(Xe);for(let je=0;je<H.length;je+=1)H[je].l(Yt);Yt.forEach(w),Wt.forEach(w),zt.forEach(w),ht.forEach(w),ee.forEach(w),A.forEach(w),this.h()},h(){m(s,"id","reader selections"),m(s,"class","flex flex-none gap-2"),m(C,"class","btn variant-filled-error"),m(C,"id","selectVar"),m(C,"type","button"),m(Q,"class","btn variant-filled-success"),m(Q,"type","button"),m(Q,"id","selectUnit"),m(J,"class","btn variant-filled-warning"),m(J,"type","button"),m(J,"id","selectDescription"),m(x,"class","btn variant-filled-secondary"),m(x,"type","button"),m(x,"color","info"),m(x,"id","selectMissingValues"),m(b,"class","btn variant-filled-primary"),m(b,"type","button"),m(b,"id","selectData"),m(X,"title","reset selection"),m(X,"id","resetSelection"),m(X,"class","btn variant-filled-warning text-lg"),m(X,"type","button"),m(M,"id","markers"),m(M,"class","py-5 flex gap-1"),m(ue,"id","missingvalues"),m(ue,"class","grow"),m(we,"id","errors"),m(we,"class","m-2 text-sm grow text-right"),m(me,"title","save"),m(me,"class","btn variant-filled-primary text-lg"),me.disabled=We=!e[6],m(Me,"class","text-right"),m(ke,"class","flex"),m(n,"id","edit"),m(n,"class","flex flex-col grow gap-2"),m(Be,"class","controls"),m(t,"class","flex gap-5"),m(He,"class","grow text-right"),m(se,"id","data infos"),m(se,"class","flex flex-auto gap-5 pb-2"),m(Fe,"class","table table-compact"),m(Qe,"class","overflow-x-auto"),m(_e,"id","preview data"),m(_e,"class","flex-col py-5"),m(r,"id","structure-suggestion-container"),m(r,"class","flex-col gap-3")},m(v,A){ne(v,l,A),f(l,r),f(r,t),f(t,n),f(n,s),W(o,s,null),f(s,a),W(_,s,null),f(s,u),W(g,s,null),f(s,h),W(T,s,null),f(n,L),f(n,M),f(M,C),f(M,K),f(M,Q),f(M,be),f(M,J),f(M,pe),f(M,x),f(M,ve),f(M,b),f(M,re),f(M,X),W(ie,X,null),f(n,Le),f(n,ue),W(fe,ue,null),f(n,lt),f(n,ke),f(ke,we);for(let ee=0;ee<te.length;ee+=1)te[ee]&&te[ee].m(we,null);f(ke,rt),f(ke,Me),f(Me,me),W(Ie,me,null),f(t,nt),f(t,Be),W(Ve,Be,null),f(r,st),f(r,_e),f(_e,se),f(se,De),f(De,Ne),f(De,at),f(De,Ye),f(se,ot),f(se,Se),f(Se,i),f(Se,p),f(Se,F),f(se,j),f(se,oe),f(oe,Z),f(oe,Vt),f(oe,mt),f(se,Dt),f(se,He),f(_e,St),f(_e,Qe),f(Qe,Fe),f(Fe,Xe);for(let ee=0;ee<H.length;ee+=1)H[ee]&&H[ee].m(Xe,null);Re=!0,At||(Rt=[q(C,"click",e[26]),q(C,"mouseover",e[27]),q(Q,"mouseover",e[28]),q(Q,"click",e[29]),q(J,"mouseover",e[30]),q(J,"click",e[31]),q(x,"mouseover",e[32]),q(x,"click",e[33]),q(b,"mouseover",e[34]),q(b,"click",e[35]),q(X,"mouseover",e[36]),q(X,"click",e[13]),q(Fe,"contextmenu",tr),q(r,"mousedown",e[8]),q(r,"mouseup",e[9]),q(l,"submit",vl(e[15]))],At=!0)},p(v,A){e=v;const ee={};A[0]&1&&(ee.source=e[0].delimeters),!c&&A[0]&1&&(c=!0,ee.target=e[0].delimeter,Ee(()=>c=!1)),o.$set(ee);const Pe={};A[0]&1&&(Pe.source=e[0].decimals),!E&&A[0]&1&&(E=!0,Pe.target=e[0].decimal,Ee(()=>E=!1)),_.$set(Pe);const ce={};A[0]&1&&(ce.source=e[0].textMarkers),!d&&A[0]&1&&(d=!0,ce.target=e[0].textMarker,Ee(()=>d=!1)),g.$set(ce);const de={};A[0]&1&&(de.source=e[0].encodings),!P&&A[0]&1&&(P=!0,de.target=e[0].fileEncoding,Ee(()=>P=!1)),T.$set(de);const ae={};if(!ze&&A[0]&1&&(ze=!0,ae.list=e[0].missingValues,Ee(()=>ze=!1)),fe.$set(ae),A[0]&8){Je=Ze(e[3]);let S;for(S=0;S<Je.length;S+=1){const Ue=Zt(e,Je,S);te[S]?te[S].p(Ue,A):(te[S]=xt(Ue),te[S].c(),te[S].m(we,null))}for(;S<te.length;S+=1)te[S].d(1);te.length=Je.length}if((!Re||A[0]&64&&We!==(We=!e[6]))&&(me.disabled=We),(!Re||A[0]&1)&&qe!==(qe=e[0].total+"")&&gt(Ye,qe),(!Re||A[0]&1)&&O!==(O=e[0].total-e[0].skipped+"")&&gt(F,O),(!Re||A[0]&1)&&ut!==(ut=e[0].skipped+"")&&gt(mt,ut),A[0]&138391){Ke=Ze(e[2]);let S;for(S=0;S<Ke.length;S+=1){const Ue=Xt(e,Ke,S);H[S]?(H[S].p(Ue,A),I(H[S],1)):(H[S]=tl(Ue),H[S].c(),I(H[S],1),H[S].m(Xe,null))}for(et(),S=Ke.length;S<H.length;S+=1)ml(S);tt()}},i(v){if(!Re){I(o.$$.fragment,v),I(_.$$.fragment,v),I(g.$$.fragment,v),I(T.$$.fragment,v),I(ie.$$.fragment,v),I(fe.$$.fragment,v),I(Ie.$$.fragment,v),I(Ve.$$.fragment,v);for(let A=0;A<Ke.length;A+=1)I(H[A]);Re=!0}},o(v){D(o.$$.fragment,v),D(_.$$.fragment,v),D(g.$$.fragment,v),D(T.$$.fragment,v),D(ie.$$.fragment,v),D(fe.$$.fragment,v),D(Ie.$$.fragment,v),D(Ve.$$.fragment,v),H=H.filter(Boolean);for(let A=0;A<H.length;A+=1)D(H[A]);Re=!1},d(v){v&&w(l),Y(o),Y(_),Y(g),Y(T),Y(ie),Y(fe),Lt(te,v),Y(Ie),Y(Ve),Lt(H,v),At=!1,Mt(Rt)}}}function Jl(e){let l,r,t,n,s,o,c,a,_;r=new xe({props:{icon:sl}});const E=[xl,Zl],u=[];function g(d,h){return!d[0]||d[4].length==0||d[5]==!1?0:1}return n=g(e),s=u[n]=E[n](e),{c(){l=$("button"),G(r.$$.fragment),t=N(),s.c(),o=Te(),this.h()},l(d){l=y(d,"BUTTON",{title:!0,class:!0});var h=V(l);z(r.$$.fragment,h),h.forEach(w),t=R(d),s.l(d),o=Te(),this.h()},h(){m(l,"title","back"),m(l,"class","btn variant-filled-warning")},m(d,h){ne(d,l,h),W(r,l,null),ne(d,t,h),u[n].m(d,h),ne(d,o,h),c=!0,a||(_=q(l,"click",e[21]),a=!0)},p(d,h){let T=n;n=g(d),n===T?u[n].p(d,h):(et(),D(u[T],1,1,()=>{u[T]=null}),tt(),s=u[n],s?s.p(d,h):(s=u[n]=E[n](d),s.c()),I(s,1),s.m(o.parentNode,o))},i(d){c||(I(r.$$.fragment,d),I(s),c=!0)},o(d){D(r.$$.fragment,d),D(s),c=!1},d(d){d&&(w(l),w(t),w(o)),Y(r),u[n].d(d),a=!1,_()}}}function xt(e){let l,r=e[67]+"",t;return{c(){l=$("label"),t=ct(r),this.h()},l(n){l=y(n,"LABEL",{class:!0});var s=V(l);t=dt(s,r),s.forEach(w),this.h()},h(){m(l,"class","text-error-500")},m(n,s){ne(n,l,s),f(l,t)},p(n,s){s[0]&8&&r!==(r=n[67]+"")&&gt(t,r)},d(n){n&&w(l)}}}function el(e){let l,r=(e[64]=e[64].replaceAll(String.fromCharCode(e[0].textMarker),""))+"",t,n,s;function o(...u){return e[38](e[63],e[66],...u)}function c(...u){return e[39](e[63],e[66],...u)}function a(...u){return e[40](e[63],e[66],...u)}function _(...u){return e[41](e[63],e[66],...u)}function E(...u){return e[42](e[63],e[66],...u)}return{c(){l=$("td"),t=ct(r),this.h()},l(u){l=y(u,"TD",{class:!0});var g=V(l);t=dt(g,r),g.forEach(w),this.h()},h(){var u,g,d,h,T;m(l,"class","hover:cursor-pointer select-none hover:border-surface-400 hover:border-solid hover:border-b-2"),ge(l,"variant-soft-error",((u=e[1].find(o))==null?void 0:u.type)===e[7].VARIABLE),ge(l,"variant-soft-success",((g=e[1].find(c))==null?void 0:g.type)===e[7].UNIT),ge(l,"variant-soft-warning",((d=e[1].find(a))==null?void 0:d.type)===e[7].DESCRIPTION),ge(l,"variant-soft-secondary",((h=e[1].find(_))==null?void 0:h.type)===e[7].MISSING_VALUES),ge(l,"variant-soft-primary",((T=e[1].find(E))==null?void 0:T.type)===e[7].DATA),ge(l,"variant-ghost-surface",e[4][e[63]][e[66]])},m(u,g){ne(u,l,g),f(l,t),n||(s=[q(l,"dblclick",e[12](e[63])),q(l,"mousedown",e[10](e[63],e[66])),q(l,"mouseenter",e[11](e[63],e[66]))],n=!0)},p(u,g){var d,h,T,P,L;e=u,g[0]&5&&r!==(r=(e[64]=e[64].replaceAll(String.fromCharCode(e[0].textMarker),""))+"")&&gt(t,r),g[0]&130&&ge(l,"variant-soft-error",((d=e[1].find(o))==null?void 0:d.type)===e[7].VARIABLE),g[0]&130&&ge(l,"variant-soft-success",((h=e[1].find(c))==null?void 0:h.type)===e[7].UNIT),g[0]&130&&ge(l,"variant-soft-warning",((T=e[1].find(a))==null?void 0:T.type)===e[7].DESCRIPTION),g[0]&130&&ge(l,"variant-soft-secondary",((P=e[1].find(_))==null?void 0:P.type)===e[7].MISSING_VALUES),g[0]&130&&ge(l,"variant-soft-primary",((L=e[1].find(E))==null?void 0:L.type)===e[7].DATA),g[0]&16&&ge(l,"variant-ghost-surface",e[4][e[63]][e[66]])},d(u){u&&w(l),n=!1,Mt(s)}}}function tl(e){let l,r,t,n,s,o,c,a,_;n=new xe({props:{icon:El,size:"sm"}});let E=Ze(e[61]),u=[];for(let g=0;g<E.length;g+=1)u[g]=el(Jt(e,E,g));return{c(){l=$("tr"),r=$("td"),t=$("div"),G(n.$$.fragment),s=N();for(let g=0;g<u.length;g+=1)u[g].c();o=N(),this.h()},l(g){l=y(g,"TR",{});var d=V(l);r=y(d,"TD",{class:!0});var h=V(r);t=y(h,"DIV",{class:!0});var T=V(t);z(n.$$.fragment,T),T.forEach(w),h.forEach(w),s=R(d);for(let P=0;P<u.length;P+=1)u[P].l(d);o=R(d),d.forEach(w),this.h()},h(){m(t,"class","pt-1"),m(r,"class","w-8 hover:cursor-pointer select-none text-sm hover:border-surface-400 hover:border-solid hover:border-b-2")},m(g,d){ne(g,l,d),f(l,r),f(r,t),W(n,t,null),f(l,s);for(let h=0;h<u.length;h+=1)u[h]&&u[h].m(l,null);f(l,o),c=!0,a||(_=q(r,"mousedown",e[17](e[63])),a=!0)},p(g,d){if(e=g,d[0]&7319){E=Ze(e[61]);let h;for(h=0;h<E.length;h+=1){const T=Jt(e,E,h);u[h]?u[h].p(T,d):(u[h]=el(T),u[h].c(),u[h].m(l,o))}for(;h<u.length;h+=1)u[h].d(1);u.length=E.length}},i(g){c||(I(n.$$.fragment,g),c=!0)},o(g){D(n.$$.fragment,g),c=!1},d(g){g&&w(l),Y(n),Lt(u,g),a=!1,_()}}}function Zl(e){let l,r,t;return r=new Bt({props:{position:ol.center,label:"Generate Structure..."}}),{c(){l=$("div"),G(r.$$.fragment),this.h()},l(n){l=y(n,"DIV",{class:!0});var s=V(l);z(r.$$.fragment,s),s.forEach(w),this.h()},h(){m(l,"class","h-full w-full text-surface-700")},m(n,s){ne(n,l,s),W(r,l,null),t=!0},p:ft,i(n){t||(I(r.$$.fragment,n),t=!0)},o(n){D(r.$$.fragment,n),t=!1},d(n){n&&w(l),Y(r)}}}function xl(e){let l,r,t;return r=new Bt({props:{position:ol.center,label:"Loading Structure Suggestion based on: "+e[0].file}}),{c(){l=$("div"),G(r.$$.fragment),this.h()},l(n){l=y(n,"DIV",{class:!0});var s=V(l);z(r.$$.fragment,s),s.forEach(w),this.h()},h(){m(l,"class","h-full w-full text-surface-700")},m(n,s){ne(n,l,s),W(r,l,null),t=!0},p(n,s){const o={};s[0]&1&&(o.label="Loading Structure Suggestion based on: "+n[0].file),r.$set(o)},i(n){t||(I(r.$$.fragment,n),t=!0)},o(n){D(r.$$.fragment,n),t=!1},d(n){n&&w(l),Y(r)}}}function er(e){let l,r,t,n;const s=[Jl,Xl],o=[];function c(a,_){return!a[0]||a[4].length==0||a[5]==!1?0:1}return l=c(e),r=o[l]=s[l](e),{c(){r.c(),t=Te()},l(a){r.l(a),t=Te()},m(a,_){o[l].m(a,_),ne(a,t,_),n=!0},p(a,_){let E=l;l=c(a),l===E?o[l].p(a,_):(et(),D(o[E],1,1,()=>{o[E]=null}),tt(),r=o[l],r?r.p(a,_):(r=o[l]=s[l](a),r.c()),I(r,1),r.m(t.parentNode,t))},i(a){n||(I(r),n=!0)},o(a){D(r),n=!1},d(a){a&&w(t),o[l].d(a)}}}const tr=e=>e.preventDefault();function lr(e,l,r){let{model:t}=l,{init:n=!0}=l,s=!1,o=[],c=[],a=0,_=0,E=!0,u=0,g=[],d=[];const h={VARIABLE:"variable",DESCRIPTION:"description",UNIT:"unit",MISSING_VALUES:"missing-values",DATA:"data"};let T=!1;const P=nl();hl(async()=>{console.log("start selection suggestion"),console.log("load selection",t.entityId,t.file),M(t.preview,String.fromCharCode(t.delimeter)),C(t.markers,n),t.delimeter,L(t.preview),re()});function L(i){r(2,g=[]),i&&(i.forEach(k=>{const p=fe(k);r(2,g=[...g,p])}),console.log("🚀 ~ onMount ~ model.preview:",t.preview),console.log("🚀 ~ onMount ~ data:",g))}function M(i,k){console.log("set table infos"),a=fe(i[0]).length,console.log("🚀 ~ setTableInfos ~ cLength:",a),_=i.length,r(4,o=new Array(_).fill(!1));for(var p=0;p<o.length;p++)r(4,o[p]=new Array(a).fill(!1),o);console.log("state",o)}function C(i,k=!1){for(var p=0;p<i.length;p++){let O=i[p];console.log("marker",O),k?U(O.type,O.row-1,O.cells):U(O.type,O.row,O.cells)}}function le(i){s=!0}function K(i){s=!1}const Q=(i,k)=>p=>{console.log(p.type),(p.which===3||p.button===2)&&console.log("Right mouse button at "+p.clientX+"x"+p.clientY),i!=u&&x(),(s||p.type==="mousedown")&&(u=i,(p.which===1||p.button===0)&&J(k),(p.which===3||p.button===2)&&B(k))},he=(i,k)=>p=>{(s||p.type==="mousedown")&&((p.which===1||p.button===0)&&J(k),(p.which===3||p.button===2)&&B(k))},be=i=>k=>{console.log("dblclick",k.type,s),(s||k.type==="dblclick")&&pe(u)},J=i=>{r(4,o[u][i]=!0,o)},B=i=>{if(r(4,o[u][i]=!1,o),console.log("deselect"),c.length>0){console.log("selection l:",c.length);for(let k=0;k<c.length;k++){const p=c[k];p&&(p.cells[i]=!1,U(p.type,p.row,p.cells))}}ve(),re()},pe=i=>{console.log("set true");for(var k=0;k<a;k++)console.log("select row",a),r(4,o[i][k]=!0,o)};function x(){r(4,o=new Array(_).fill(!1));for(var i=0;i<o.length;i++)r(4,o[i]=new Array(a).fill(!1),o)}function Ge(){r(1,c=[]),r(6,T=!1)}function ve(){r(1,c=c.filter(i=>i.cells.find(k=>k===!0)))}function b(i){let k=o[u];c.length>0&&(k=c[0].cells),U(i,u,k),re()}function U(i,k,p){let O={type:i,row:k,cells:p},F=c.find(j=>j.row==O.row);F&&r(1,c=c.filter(j=>j.row!==O.row)),F=c.find(j=>j.type==O.type),F&&r(1,c=c.filter(j=>j.type!==O.type)),r(1,c=[...c,O])}function re(){var O;r(3,d=[]);let i=c.find(F=>F.type==h.VARIABLE),k=c.find(F=>F.type==h.DATA);if(c.length>0){i||d.push("the variables still need to be marked"),k||d.push("the data still need to be marked");let F=0;for(let j=0;j<c.length;j++){const oe=c[j];console.log(j,oe);let Z=(O=oe.cells.filter(it=>it==!0))==null?void 0:O.length;if(j>0&&Z!=F){d.push("selection mismatch, the rows must have the same number of marked cells  ");break}F=Z}r(6,T=d.length==0)}else r(6,T=!1),r(3,d=[])}async function X(){if(r(5,E=!0),r(0,t.markers=c,t),t.entityId>0){console.log("save selection",t);let i=await Ul(t);console.log(i),i!=!1&&(console.log("selection",i),P("saved",t),r(5,E=!1))}else P("saved",t),r(5,E=!1)}function ie(){M(t.preview,String.fromCharCode(t.delimeter)),L(t.preview)}const Le=i=>k=>{console.log(i,k.which,k.button),(k.which===1||k.button===0)&&(x(),console.log(i),pe(i),u=i),(k.which===3||k.button===2)&&x()};async function ue(i){const k=i;console.log("🚀 ~ e.detail:",i);const p=await ul(t.file,t.entityId,k,0);r(0,t.preview=p.preview,t)}function fe(i){const k=String.fromCharCode(t.delimeter),p=String.fromCharCode(t.textMarker),O=i.split(k);let F=[];if(i.includes(p)){let j="",oe=!1;return O.forEach(Z=>{Z.includes(p)?Z.startsWith(p)&&Z.endsWith(p)?F=[...F,Z]:(Z.startsWith(p)&&(j=Z,oe=!0),Z.endsWith(p)&&(j+=k+Z,F=[...F,j],oe=!1)):oe?j+=k+Z:F=[...F,Z]}),F}else return O}function ze(){$t("/rpm/datastructure/create")}const lt=()=>ze();function ke(i){e.$$.not_equal(t.delimeter,i)&&(t.delimeter=i,r(0,t))}function we(i){e.$$.not_equal(t.decimal,i)&&(t.decimal=i,r(0,t))}function rt(i){e.$$.not_equal(t.textMarker,i)&&(t.textMarker=i,r(0,t))}function Me(i){e.$$.not_equal(t.fileEncoding,i)&&(t.fileEncoding=i,r(0,t))}const me=()=>b(h.VARIABLE),Ie=()=>Ae.show("selectVar"),We=()=>Ae.show("selectUnit"),nt=()=>b(h.UNIT),Be=()=>Ae.show("selectDescription"),Ve=()=>b(h.DESCRIPTION),st=()=>Ae.show("selectMissingValues"),_e=()=>b(h.MISSING_VALUES),se=()=>Ae.show("selectData"),De=()=>b(h.DATA),Ne=()=>Ae.show("resetSelection");function pt(i){e.$$.not_equal(t.missingValues,i)&&(t.missingValues=i,r(0,t))}const at=(i,k,p)=>p.row===i&&p.cells[k]===!0,qe=(i,k,p)=>p.row===i&&p.cells[k]===!0,Ye=(i,k,p)=>p.row===i&&p.cells[k]===!0,ot=(i,k,p)=>p.row===i&&p.cells[k]===!0,Se=(i,k,p)=>p.row===i&&p.cells[k]===!0;return e.$$set=i=>{"model"in i&&r(0,t=i.model),"init"in i&&r(20,n=i.init)},e.$$.update=()=>{e.$$.dirty[0]&1,e.$$.dirty[0]&2,e.$$.dirty[0]&4,e.$$.dirty[0]&8},[t,c,g,d,o,E,T,h,le,K,Q,he,be,Ge,b,X,ie,Le,ue,ze,n,lt,ke,we,rt,Me,me,Ie,We,nt,Be,Ve,st,_e,se,De,Ne,pt,at,qe,Ye,ot,Se]}class rr extends Tt{constructor(l){super(),It(this,l,lr,er,Ct,{model:0,init:20},null,[-1,-1,-1])}}function nr(e){let l,r;return l=new $l({props:{error:e[14]}}),{c(){G(l.$$.fragment)},l(t){z(l.$$.fragment,t)},m(t,n){W(l,t,n),r=!0},p:ft,i(t){r||(I(l.$$.fragment,t),r=!0)},o(t){D(l.$$.fragment,t),r=!1},d(t){Y(l,t)}}}function sr(e){let l,r,t=e[0]&&ll(e);return{c(){t&&t.c(),l=Te()},l(n){t&&t.l(n),l=Te()},m(n,s){t&&t.m(n,s),ne(n,l,s),r=!0},p(n,s){n[0]?t?(t.p(n,s),s&1&&I(t,1)):(t=ll(n),t.c(),I(t,1),t.m(l.parentNode,l)):t&&(et(),D(t,1,1,()=>{t=null}),tt())},i(n){r||(I(t),r=!0)},o(n){D(t),r=!1},d(n){n&&w(l),t&&t.d(n)}}}function ll(e){let l,r,t,n;const s=[or,ar],o=[];function c(a,_){return a[1]?0:a[0].variables?1:-1}return~(l=c(e))&&(r=o[l]=s[l](e)),{c(){r&&r.c(),t=Te()},l(a){r&&r.l(a),t=Te()},m(a,_){~l&&o[l].m(a,_),ne(a,t,_),n=!0},p(a,_){let E=l;l=c(a),l===E?~l&&o[l].p(a,_):(r&&(et(),D(o[E],1,1,()=>{o[E]=null}),tt()),~l?(r=o[l],r?r.p(a,_):(r=o[l]=s[l](a),r.c()),I(r,1),r.m(t.parentNode,t)):r=null)},i(a){n||(I(r),n=!0)},o(a){D(r),n=!1},d(a){a&&w(t),~l&&o[l].d(a)}}}function ar(e){let l,r;return l=new Wl({props:{model:e[0]}}),l.$on("back",e[6]),{c(){G(l.$$.fragment)},l(t){z(l.$$.fragment,t)},m(t,n){W(l,t,n),r=!0},p(t,n){const s={};n&1&&(s.model=t[0]),l.$set(s)},i(t){r||(I(l.$$.fragment,t),r=!0)},o(t){D(l.$$.fragment,t),r=!1},d(t){Y(l,t)}}}function or(e){let l,r,t,n,s;function o(a){e[7](a)}let c={init:e[2]};return e[0]!==void 0&&(c.model=e[0]),r=new rr({props:c}),ye.push(()=>Ce(r,"model",o)),r.$on("saved",e[5]),{c(){l=$("div"),G(r.$$.fragment)},l(a){l=y(a,"DIV",{});var _=V(l);z(r.$$.fragment,_),_.forEach(w)},m(a,_){ne(a,l,_),W(r,l,null),s=!0},p(a,_){const E={};_&4&&(E.init=a[2]),!t&&_&1&&(t=!0,E.model=a[0],Ee(()=>t=!1)),r.$set(E)},i(a){s||(I(r.$$.fragment,a),a&&rl(()=>{s&&(n||(n=yt(l,Et,{},!0)),n.run(1))}),s=!0)},o(a){D(r.$$.fragment,a),a&&(n||(n=yt(l,Et,{},!1)),n.run(0)),s=!1},d(a){a&&w(l),Y(r),a&&n&&n.end()}}}function ir(e){let l,r;return l=new Bt({props:{label:e[3]}}),{c(){G(l.$$.fragment)},l(t){z(l.$$.fragment,t)},m(t,n){W(l,t,n),r=!0},p(t,n){const s={};n&8&&(s.label=t[3]),l.$set(s)},i(t){r||(I(l.$$.fragment,t),r=!0)},o(t){D(l.$$.fragment,t),r=!1},d(t){Y(l,t)}}}function ur(e){let l,r,t={ctx:e,current:null,token:null,hasCatch:!0,pending:ir,then:sr,catch:nr,error:14,blocks:[,,,]};return kl(e[4](),t),{c(){l=Te(),t.block.c()},l(n){l=Te(),t.block.l(n)},m(n,s){ne(n,l,s),t.block.m(n,t.anchor=s),t.mount=()=>l.parentNode,t.anchor=l,r=!0},p(n,s){e=n,wl(t,e,s)},i(n){r||(I(t.block),r=!0)},o(n){for(let s=0;s<3;s+=1){const o=t.blocks[s];D(o)}r=!1},d(n){n&&w(l),t.block.d(n),t.token=null,t=null}}}function fr(e){let l,r;return l=new Cl({props:{title:"Data structure",note:"This page allows you to create and edit a selected data structure.",contentLayoutType:Tl.full,help:!0,$$slots:{default:[ur]},$$scope:{ctx:e}}}),{c(){G(l.$$.fragment)},l(t){z(l.$$.fragment,t)},m(t,n){W(l,t,n),r=!0},p(t,[n]){const s={};n&32783&&(s.$$scope={dirty:n,ctx:t}),l.$set(s)},i(t){r||(I(l.$$.fragment,t),r=!0)},o(t){D(l.$$.fragment,t),r=!1},d(t){Y(l,t)}}}function cr(e,l,r){let t=Sl,n,s,o=0,c,a,_=!0,E=!0,u="the structure is loading";async function g(){var he,be,J,B,pe;Ae.setHelpItemList(t),n=document.getElementById("datastructure"),s=Number(n==null?void 0:n.getAttribute("dataset")),Number(n==null?void 0:n.getAttribute("version")),c=""+(n==null?void 0:n.getAttribute("file")),o=Number(n==null?void 0:n.getAttribute("structure")),c&&r(3,u="the file "+c+" is currently being analyzed");const P=((he=n==null?void 0:n.getAttribute("isTemplateRequired"))==null?void 0:he.toLocaleLowerCase())=="true";Al.set(P);const L=((be=n==null?void 0:n.getAttribute("isMeaningRequired"))==null?void 0:be.toLocaleLowerCase())=="true";Ll.set(L);const M=((J=n==null?void 0:n.getAttribute("setByTemplate"))==null?void 0:J.toLocaleLowerCase())=="true";Ml.set(M);const C=((B=n==null?void 0:n.getAttribute("enforcePrimaryKey"))==null?void 0:B.toLocaleLowerCase())=="true";il.set(C);const le=((pe=n==null?void 0:n.getAttribute("changeablePrimaryKey"))==null?void 0:pe.toLocaleLowerCase())=="true";Bl.set(le),console.log("🚀 ~ file: +page.svelte:69 ~ start ~ file:",c),c!=""?(console.log("file exist",c,s,0),r(0,a=await ul(c,s,65001,0)),console.log("🚀 ~ start ~ model:",a)):o>0?(console.log("copy structure"),r(0,a=await Ol(o)),r(1,_=!1)):(console.log("empty structure"),r(0,a=await ql()),r(1,_=!1));const K=await Hl();Nl.set(K);const Q=await Fl();Rl.set(Q)}async function d(P){r(0,a=P.detail);let L=await Kl(P.detail);L!=null&&(r(0,a=L),r(1,_=!1))}function h(){r(1,_=!0),r(2,E=!1)}function T(P){a=P,r(0,a)}return e.$$.update=()=>{e.$$.dirty&1,e.$$.dirty&2},[a,_,E,u,g,d,h,T]}class yr extends Tt{constructor(l){super(),It(this,l,cr,fr,Ct,{})}}export{yr as component};
