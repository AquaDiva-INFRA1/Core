@using Telerik.Web.Mvc.UI
@using BExIS.Dlm.Entities.DataStructure
@using BExIS.Dlm.Services.DataStructure
@using System
@using System.Text.RegularExpressions
@using BExIS.Web.Shell.Areas.RPM.Controllers
@model List<BExIS.Dlm.Entities.DataStructure.Unit>

@{
    string rgxPattern = "[ ]";
    string rgxReplace = "_";
    Regex rgx = new Regex(rgxPattern);
    
    Unit unit = (Unit)Session["Unit"];
    string windowName = "Add";
    
    if(unit != null)
    {
        if (unit.Name != null && unit.Name != "")
        {
            windowName = rgx.Replace(unit.Name, rgxReplace);
        }
    }
    else
    {
        windowName = "Add";
        unit = new Unit(); 
    }
    
}

@{
    ViewBag.Title = "Unit Manager";
}

@section Scripts{
    <script src="@Url.Content("~/Scripts/jQueryUI/1.10.4/js/jquery-ui-1.10.4.custom.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/bppHelper.js")" type="text/javascript"></script>
    
}


    <div>
        <h2>Unit Manager</h2>
         
        <p>With this interface you are able to manage (e.g. create, edit, delete) units which may be needed to define data attributes. Units cannot be edited or deleted once they are associated with a data attribute (they become locked).</p>
    </div>

<br />
<div title="Create a new Unit">
    @Html.ActionLink("Create Unit", "openUnitWindow", "Home", new { id = 0 }, new { @class = "t-button t-add" })
</div>
<br />
<br />

    @(Html.Telerik().Grid(Model)    
            .Name("UnitGrid")
            .Sortable() 
            .Scrollable(t => t.Height(400))         
            .Columns(columns =>
                {
                    columns.Template(
                        @<text>
                            
                            @if(!(item.DataContainers.Count > 0))
                            {
                            <div class="t-button t-button-icontext t-button-bare">
                            @Html.ActionLink("Edit", "openUnitWindow", "Home", new { id = item.Id }, new { @class = "t-icon t-edit" })
                            @Html.ActionLink("Delete", "deletUnit", "Home", new { id = item.Id, item.Name }, new { @class = "t-icon t-delete" })
                            
                            </div>
                            }
                            else
                            {
                                <div class="locked">locked</div>
                            }
                            
                        </text>
                    ).Title("Actions")
                        .Width(80)
                        .ClientTemplate(
                            @Html.ActionLink("Edit", "openUnitWindow", "Home", new { id = "<#= id #>" }, new { @class = "t-icon t-edit" }).ToHtmlString() +
                            @Html.ActionLink("Delete", "deletUnit", "Home", new { id = "<#= id #>", unit.Name}, new { @class = "t-icon t-delete" }).ToHtmlString()
                            );
                    columns.Bound(c => c.Name).Width(150);
                    columns.Bound(c => c.Id).Width(50);
                    columns.Bound(c => c.Abbreviation).Width(100);
                    columns.Bound(c => c.Dimension).Width(100);
                    columns.Bound(c => c.MeasurementSystem).Width(160);
                    columns.Template(
                        @<text>
                            @{string temp = "";
                              foreach (DataType dt in item.AssociatedDataTypes)
                              {
                                  if (temp== "") 
                                  {temp = dt.Name;}
                                  else  
                                  {temp = temp + ", " + dt.Name;}
                              }
                              }
                              @temp 
                        </text>
                    ).Title("Associated Data Types").Width(160);
                    columns.Bound(c => c.Description);
                })
    )
<br />
<br />
<div title="Create a new Unit">
    @Html.ActionLink("Create Unit", "openUnitWindow", "Home", new { id = 0 }, new { @class = "t-button t-add" })
</div>
<br />
    

    <div style="position:absolute; left:20%; top:60px;">
                    @{ Html.Telerik().Window()
                            .Name(windowName)
                            .Draggable(true)
                            .Modal(true)
                            .Visible((bool)Session["Window"])
                            .Content(@<text>
                                        @Html.Partial("_editUnit", unit)
                                        </text>)
                            .Width(800)
                            .Render()
                            ;
        
                    }
        @{Session["Window"] = false;}


     
    </div>



   
@*<script type="text/javascript">

    $(".test")
        .click(function () {
            $('<div style="background-color: yellow;"></div>')
                .html('<div><h6> You are trying to delete! </h6></div>')
                .dialog({
                    modal: true, title: 'message', autoOpen: true,
                    width: '200', height: '150', resizable: false,
                    buttons: {
                        OK: function () {
                            $.post
                            $(this).remove();
                            $deletUnit();
                            doFunctionForOK();
                        },
                        Cancel: function () {
                            $(this).remove();
                            $(".test").val(false);
                        }
                    }
                });
        })
        .hover(function () {
            $(this).html("<b>test</b>")
        }, function () {
            $(this).text("test");
        });
</script>*@