@using BExIS.Modules.Sam.UI.Models
@using Telerik.Web.Mvc.UI
@model System.Collections.Generic.IEnumerable<BExIS.Modules.Sam.UI.Models.FeatureTreeViewModel>
@(Html.Telerik().TreeView()
        .Name("TreeView_Features")
        .ShowCheckBox(true)
        .BindTo(Model, mappings =>
        {
            mappings.For<FeatureTreeViewModel>(binding => binding

                .ItemDataBound((item, feature) =>
                {
                    item.Text = feature.FeatureName;
                    item.Value = feature.Id.ToString();
                    item.Checked = feature.IsFeatureInEveryoneGroup;
                    item.LinkHtmlAttributes["title"] = "Select " + feature.FeatureName + " to manage the corresponding feature permissions on the right.";
                })
                .Children(feature => feature.Children));
        })
        .ClientEvents(events => events
            .OnSelect("OnSelect")
            .OnChecked("OnChecked")
        )
        .ExpandAll(true)
)

<script type="text/javascript">

    function GetTreeView() {
        return $('#TreeView_Features').data('tTreeView');
    }

    function OnChecked(e) {
        var value = e.checked;
        var featureId = GetTreeView().getItemValue(e.item);

        $.post('@Url.Action("SetFeaturePublicity", "FeaturePermissions")', { FeatureId: featureId, Value: value }, function (e) {
            GetTreeView().dataSource.read();
        });
    }

    function OnSelect(e) {
        var featureID = GetTreeView().getItemValue(e.item);

        $('#Content_Subjects').empty();

        $.get('@Url.Action("Subjects", "FeaturePermissions")', { Id: featureID }, function (contentData) {

            $('#Content_Subjects').html(contentData);
        });
    }

    // Feature Permission
    function setFeaturePermission(value, subjectId, featureId) {
        $.post('@Url.Action("SetFeaturePermission", "FeaturePermissions")', { SubjectId: subjectId, FeatureId: featureId, Value: value }, function (e) {
            $("#Grid_Subjects .t-refresh").trigger('click');
        });
    }

    $(":checkbox").attr("title", "Checked \t -> \t public feature \nUnchecked \t -> \t NOT public feature");
</script>