@using BExIS.Modules.Sam.UI.Models
@using Telerik.Web.Mvc.UI

@model long

@(Html.Telerik().Grid<UserMembershipGridRowModel>()
      .Name("Grid_Users")
      .Columns(columns =>
      {
          columns.Bound(g => g.IsUserInGroup)
              .Template(@<text>
            @if (item.IsUserInGroup)
            {
                <input type='checkbox' name='selectedUsers' value='@item.Id' checked='checked' />
            }
            else
            {
                <input type='checkbox' name='selectedUsers' value='@item.Id' />
            }
            </text>)
              .ClientTemplate("<input type='checkbox' name='selectedUsers' value='<#= Id #>' <#= IsUserInGroup ? checked='checked' : '' #> />")
              .Title("Member")
              .Width(64)
              .Filterable(false)
              .HtmlAttributes(new { style = "text-align:center" });
          columns.Bound(g => g.Id);
          columns.Bound(g => g.Name);
          columns.Bound(g => g.Email);
          columns.Bound(g => g.IsAdministrator);
      })
      .ClientEvents(events =>
      {
          events.OnDataBound("onDataBound");
      })
      .DataBinding(dataBinding => dataBinding
          .Ajax()
          .OperationMode(GridOperationMode.Server)
          .Select("Users_Select", "Groups", new { GroupId = Model }))
      .Filterable()
      .Pageable(pageable =>
      {
          pageable.PageSize(10, new[] { 10, 20, 50, 100 });
          pageable.Style(GridPagerStyles.NextPreviousAndNumeric | GridPagerStyles.PageSizeDropDown);
          pageable.Position(GridPagerPosition.Bottom);
      })
          .Sortable(sortable => sortable.OrderBy(order => order.Add(c => c.Id).Descending())))

<script>
    function Grid_Groups_OnDataBound() {
        addTooltips();
        resetAllTelerikIconTitles();

        $("input[name='selectedUsers']:checkbox")
            .click(function () {
                if ($(this).is(':checked')) {
                    $.post('@Url.Action("AddUserToGroup", "Groups")', { UserId: $(this).attr('value'), GroupId: Model }, function (e) {
                        $("#Grid_Users .t-refresh").trigger('click');
                    });
                } else {
                    $.post('@Url.Action("RemoveUserFromGroup", "Groups")', { UserId: $(this).attr('value'), GroupId: Model }, function (e) {
                        $("#Grid_Users .t-refresh").trigger('click');
                    });
                }
            });
    }
</script>