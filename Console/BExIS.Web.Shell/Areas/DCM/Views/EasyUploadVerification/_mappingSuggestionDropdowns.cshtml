@model Tuple<int, Dictionary<string, List<BExIS.Modules.Dcm.UI.Models.OntologyMappingSuggestionModel>>>
@{ 
    Dictionary<string, List<BExIS.Modules.Dcm.UI.Models.OntologyMappingSuggestionModel>> suggestionDictionary = Model.Item2;
}
@foreach(string category in suggestionDictionary.Keys)
{
    //For each category, create a separate dropdown
    <div class="suggestionContainer">
        <label for="@category annotation">@category</label>
        <select data-headerid="@Model.Item1" name="@category annotation" onchange="mappingSelected(this)">
            @foreach(BExIS.Modules.Dcm.UI.Models.OntologyMappingSuggestionModel suggestion in suggestionDictionary[category])
            {
                //For each suggestion create an option
                <option title="@suggestion.conceptURI" data-category="@category" @if (suggestion.selected) {<text>selected</text> }>@suggestion.displayName</option>
            }
        </select>
    </div>
}

<script>
    function mappingSelected(selectObject) {
        var select = $(selectObject);
        //Find the header ID
        var headerID = select.data('headerid');
        //Find the category of the selected element
        var category = select.find("option:selected").data("category");
        //Get the selected URI
        var uri = select.find("option:selected").attr("title");

        console.log("Selected " + headerID + " - " + uri + " from category " + category);
        //Send to bus
        $.post('@Url.Action("SaveAnnotationSelection", "EasyUploadVerification", new RouteValueDictionary { { "area", "DCM" } })',
            {
                headerID: headerID,
                category: category,
                uri: uri
            });
    }

    $('.suggestionContainer select[data-headerid="@Model.Item1"]').each(function () {
        mappingSelected(this);
    });
</script>

<style>
    .suggestionContainer{
        display: block;
    }
    .suggestionContainer label {
        float: left;
        clear: left;
    }
    .suggestionContainer select{
        float: right;
    }
</style>