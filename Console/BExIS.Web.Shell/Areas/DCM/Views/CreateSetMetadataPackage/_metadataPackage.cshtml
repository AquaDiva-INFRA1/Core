
@model MetadataPackageModel

@using BExIS.Web.Shell.Areas.DCM.Models.Metadata
@using Telerik.Web.Mvc.UI
@using BExIS.IO.Transform.Validation.Exceptions; 

@{
    string id = @Model.StepInfo.Id.ToString(); // XXX METADATSTRUCTURE+ "_"+Model..MetadataStructure.Id;
    string packageUsageIdPackage = id+"_Package";
    string idAdd = id + "_Add"; 
    string idRemove = id + "_Remove";

    long idAsLong = @Model.StepInfo.Id;
 }

<div id="@id" class="createWizardStep">

    <div class="createWizardStep_Main">
        <div class="createWizardStep_Header stepper">
            <h3>@Model.DisplayName</h3>
        </div>

        <div class="createWizardStep_Description stepper">
            <p>
                @Model.Discription
            </p>
        </div>

        <div class="packages">
 
         
            @if (Model.MinCardinality > 0 && Model.Instance.Count< Model.MaxCardinality)
            {
            
                @Ajax.ActionLink("Add", "AddMetadataPackageUsage", @Model.StepInfo.GetActionInfo.ControllerName, new { area = @Model.StepInfo.GetActionInfo.AreaName, stepId = @idAsLong, number = @Model.Instance.Count },
                                new AjaxOptions
                                {
                                    UpdateTargetId = @id,
                                    HttpMethod = "GET",
                                    OnSuccess = "OnSucess()",
                                    OnBegin = "OnLoad()"
                                },
                                new { @class="t-icon t-add"})
            }

            <table>
 
            @foreach (MetadataInstanceModel instance in Model.Instance)
            { 
                <tr>
                    @*<td>@instance.Name</td>*@
                    <td>@instance.Number</td>
                    @if (Model.Instance.Count > 1 && Model.Instance.Count> Model.MinCardinality)
                    {
                        <td>
                            @Ajax.ActionLink("Delete", "RemoveMetadataPackageUsage", @Model.StepInfo.GetActionInfo.ControllerName, new { area = @Model.StepInfo.GetActionInfo.AreaName, stepId= @idAsLong , number= @instance.Number }, 
                                                    new AjaxOptions 
                                                    { 
                                                        UpdateTargetId = @id, 
                                                        HttpMethod = "GET",
                                                        OnSuccess="OnSucess()",
                                                        OnBegin="OnLoad()"
                                                    },
                                                    new { @class="t-icon t-delete"})

                        </td>
                    }
                </tr>
            }
            </table>

        </div>
        <br />

@*        @Ajax.ActionLink("Validate", "ValidateStep",@Model.StepInfo.GetActionInfo.ControllerName,new RouteValueDictionary { { "area", "DCM" } },
                 new AjaxOptions { HttpMethod = "GET", 
                 InsertionMode = InsertionMode.Replace, 
                 UpdateTargetId = @id
                 },
                 new { @class = "t-button",  @style="float:right" })
 *@
    </div>

    <div class="createWizardStep_Success stepper">

        @if (Model != null && Model.StepInfo.notExecuted == false)
        {
            if (Model.ErrorList.Count == 0)
            {
                // if primary keys unique
               <p>no errors</p>
            }
        }

    </div>

    <div class="createWizardStep_Error stepper">
     @*   @if (Model != null)
        {
            @Html.Partial("_errorMessages", @Model.ErrorList) 

        }*@
    </div>   

</div>
<script type="text/javascript">

    function OnLoad()
    {
        $('#preloader').show();
    }

    function OnSucess()
    {
        NavigationRefresh();
        TaskListRefresh();
        $('#preloader').hide();
    }

</script>