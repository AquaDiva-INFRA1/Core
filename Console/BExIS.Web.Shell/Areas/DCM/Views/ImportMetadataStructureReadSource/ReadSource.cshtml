@model BExIS.Web.Shell.Areas.DCM.Models.ImportMetadata.ReadSourceModel
@using Telerik.Web.Mvc.UI;
@using System;
@using System.Web.Configuration;
@using BExIS.Web.Shell.Areas.DCM.Models;

@{
    
    string id = @Model.StepInfo.GetActionInfo.ActionName;

}

<div id="@id" class="wizardStep">

     <div class="wizardStep_Main">
        <div class="wizardStep_Header stepper">

            <h3>@Model.StepInfo.title</h3>
        </div>

        <div class="wizardStep_Description stepper">
            

        </div>
        
        <div class="wizardStep_Content stepper">

            <table>
                <tr>
                    <td>@Html.LabelFor(m => m.SchemaName)</td>
                    <td>@Html.TextBoxFor(m => m.SchemaName)</td>
                </tr>
                <tr>
                    <td>@Html.LabelFor(m => m.RootNode)</td>
                    <td>@Html.TextBoxFor(m => m.RootNode)</td>
                </tr>

                <tr>
                    <td>
                        @Ajax.ActionLink("Generate", "GenerateMS",@Model.StepInfo.GetActionInfo.ControllerName,new RouteValueDictionary { { "area", "DCM" } },
                                         new AjaxOptions { HttpMethod = "GET", 
                                         InsertionMode = InsertionMode.Replace, 
                                         UpdateTargetId = @id,
                                         OnBegin="generateOnBegin",
                                         OnSuccess="generateOnSuccess"
                                         },
                                         new { @class = "t-button" })

                    </td>
                    <td></td>
                </tr>

            </table>
        </div>
    </div>

     <div class="wizardStep_Success stepper">
       @if (Model != null)
       {
           if (Model.ErrorList != null)
           {
               if (Model.ErrorList.Count == 0)
               {
                   if (!Model.StepInfo.notExecuted)
                   { 
                      <b>the metadata structure @Model.SchemaName was created successfully</b>
                   }
               }
           }
       }
     </div>

     <div class="wizardStep_Error stepper">

        @Html.ValidationSummary(true)

        @if (Model != null)
        {
            if (Model.ErrorList != null)
            {
                if (Model.ErrorList.Count == 0)
                {


                }
                else
                { 
                   <ul>
                        @foreach (BExIS.IO.Transform.Validation.Exceptions.Error s in @Model.ErrorList)
                        { 
                            <li>@s.ToString()</li>
                        }
                   </ul>

                }
            }

        }
    </div>     

</div>

<script type="text/javascript">

    function generateOnBegin()
    {
        $('#preloader').show();
    }

    function generateOnSuccess() {
        $('#preloader').hide();
    }

    $('#RootNode').change(function () {

        var name = $('#RootNode').val();

        $.post('@Url.Action("SetRootNode", @Model.StepInfo.GetActionInfo.ControllerName, new RouteValueDictionary { { "area", "DCM" } })', { name: name }, function (response) {
        })

    })

    $('#SchemaName').change(function () {

        var name = $('#SchemaName').val();

        $.post('@Url.Action("SetSchemaName", @Model.StepInfo.GetActionInfo.ControllerName, new RouteValueDictionary { { "area", "DCM" } })', { name: name }, function (response) {
        })

    })

    $('#TitleNode').change(function () {

        var name = $('#TitleNode').val();

        $.post('@Url.Action("SetTitleNode", @Model.StepInfo.GetActionInfo.ControllerName, new RouteValueDictionary { { "area", "DCM" } })', { name: name }, function (response) {
        })

    })

    $('#DescriptionNode').change(function () {

        var name = $('#DescriptionNode').val();

        $.post('@Url.Action("SetDescriptionNode", @Model.StepInfo.GetActionInfo.ControllerName, new RouteValueDictionary { { "area", "DCM" } })', { name: name }, function (response) {
        })

    })

</script>