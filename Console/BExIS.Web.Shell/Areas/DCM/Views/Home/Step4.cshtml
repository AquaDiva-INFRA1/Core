@model BExIS.Web.Shell.Areas.DCM.Models.PrimaryKeyViewModel
@using BExIS.Web.Shell.Areas.DCM.Models;


<div id="Step4" class="uploadWizardStep">
    <div class="uploadWizardStep_Main">
        <div class="uploadWizardStep_Header stepper">
            <h3>@Model.StepInfo.title</h3>
        </div>

        <div class="uploadWizardStep_Description stepper">
            <p>

            </p>
        </div>

        <div id="variableCheckBoxList" class="uploadWizardStep_Content stepper">

            @foreach (ListViewItem s in Model.VariableLableList)
            { 
                    @Html.CheckBox(@s.Title,false)  <b>@s.Title</b>
            }


             <p><button id="checkButton" title="Check selected variables form primary key" >Check</button>....</p>
        </div>
    </div>
     <div class="uploadWizardStep_Error stepper">
        @if (Model != null)
        {
            // if primary keys unique
            if (Model.IsUnique)
            { 
                <ul>
                    <li>Primarykeys :</li>
                    @foreach (ListViewItem s in Model.PrimaryKeysList)
                    { 
                        <li>@s.Title.ToString()</li>
                    }
                 
                    <li>
                        Unique!!!
                    </li>

                </ul>
            }
            
            if (Model.ErrorList != null)
            {
                if (Model.ErrorList.Count == 0)
                {


                }
                else
                { 
                   <ul>
                        @foreach (BExIS.DCM.Transform.Validation.Exceptions.Error s in @Model.ErrorList)
                        { 
                            <li>@s.ToString()</li>
                        }
                   </ul>

                }
            }

        }
    </div>   
</div>

<script type="text/javascript">


    $('#checkButton').click(function () {

        var selected = new Array();

        $('#variableCheckBoxList input:checked').each(function () {
            selected.push($(this).attr('name'));
        });

        alert(selected);

        $.ajax({
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(selected),
            dataType: 'html',
            url: '@Url.Action("CheckPrimaryKeys", @Model.StepInfo.GetActionInfo.ControllerName, new RouteValueDictionary { { "area", @Model.StepInfo.GetActionInfo.AreaName }})',
            success: function (result) {
                $(@Model.StepInfo.GetActionInfo.ActionName.ToString()).html(result);
            }
         });
    });

</script>
