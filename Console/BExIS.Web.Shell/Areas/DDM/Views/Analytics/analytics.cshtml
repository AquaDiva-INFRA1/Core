
@using BExIS.Modules.Ddm.UI.Controllers;
@using Telerik.Web.Mvc.UI;

<header>
    <script type="text/javascript" src="/Scripts/trunk8.js"></script>
    <script type="text/javascript" src="/Scripts/jquery.ba-resize.min.js"></script>
</header>


@section Information
{
    <p>Click on the <b>Well location</b> to retreive <b>the dataset</b> that have samples from that location..</p>
    <p>
        Datasets from <b>Aquadiva</b> that are connected to the selected location are displayed in a table under the map.<br />
        To view the details of a dataset, click the <b>View Details</b> button available at the end of each row.
    </p>
}


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<div id="searchContent">

    @*
        <table>
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Dataset ID</th>
                    <th scope="col">Number of Variables </th>
                    <th scope="col">Number of Concepts</th>
                    <th scope="col">Number of Characteristics</th>
                    <th scope="col">Semantic Coverage</th>
                    <th scope="col">More Details</th>
                </tr>
            </thead>
            <tbody>

                @{
                    List<Variable_analytics> VA_list = (List<Variable_analytics>)ViewData["VA_list"];
                    int index = -1;
                    foreach (Variable_analytics va in VA_list)
                    {
                        index = index + 1;
                        <tr>
                            <td>@va.dataset_id</td>
                            <td>@va.variable_label.Count</td>
                            <td>@va.variable_concept_entity.Count</td>
                            <td>@va.variable_concept_caracteristic.Count</td>
                            <td>@va.variable_concept_entity.Count / @va.variable_label.Count</td>
                            <td><a id="@index" onclick='moredetails(this)'>View More</a></td>
                            <td></td>
                        </tr>
                    }
                }
            </tbody>
        </table>
        *@



        <h3> General Report</h3>
        <table>
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Dataset Count</th>
                    <th scope="col">Variables Count</th>
                    <th scope="col">Concepts Count</th>
                    <th scope="col">Characteristics Count</th>
                    <th scope="col">Total Semantic Coverage</th>
                </tr>
            </thead>
            <tbody>
                @{
                    List<Variable_analytics> VA_listt = (List<Variable_analytics>)ViewData["VA_list"];

                    int ds_count = VA_listt.Count;
                    int somme_Variables = 0;
                    int somme_Concepts = 0;
                    int somme_Caracteristics = 0;

                    foreach (Variable_analytics va in VA_listt)
                    {
                        foreach (String s in va.variable_concept_entity)
                        {
                            if (s != "No Annotation")
                            {
                                somme_Concepts = somme_Concepts + 1;
                            }
                        }
                        foreach (String s in va.variable_concept_caracteristic)
                        {
                            if (s != "No Annotation")
                            {
                                somme_Caracteristics = somme_Caracteristics + 1;
                            }
                        }
                        somme_Variables = somme_Variables + va.variable_id.Count;
                    }

                    <tr>
                        <td>@ds_count</td>
                        <td>@somme_Variables</td>
                        <td>@somme_Concepts</td>
                        <td>@somme_Caracteristics</td>
                        <td>@somme_Concepts/ @somme_Variables</td>
                    </tr>
                }

            </tbody>
        </table>
    
        <br />
        <button id="downloadCsvButton" class="bx-button function" title="Csv download" onclick="download()">Download Full Report</button>
        <br />

    <h3> Detailed Report</h3>
    <table>
        <thead class="thead-dark">
            <tr>
                <th scope="col">Dataset id</th>
                <th scope="col">Semantic Coverage</th>
                <th scope="col">Variables id</th>
                <th scope="col">Variables label</th>
                <th scope="col">Concepts URI</th>
                <th scope="col">Characteristics URI</th>
                <th scope="col">Unit</th>
                <th scope="col">Data type</th>
            </tr>
        </thead>
        <tbody>
            @{
                List<Variable_analytics> VA_list = (List<Variable_analytics>)ViewData["VA_list"];

                foreach (Variable_analytics va in VA_list)
                {
                    if (va.variable_id.Count > 0)
                    { 
                        int Concepts_count = 0;
                        int Caracteristics_count = 0;
                        

                        foreach (String s in va.variable_concept_entity)
                        {
                            if (s != "No Annotation")
                            {
                                Concepts_count = Concepts_count + 1;
                            }
                        }
                        foreach (String s in va.variable_concept_caracteristic)
                        {
                            if (s != "No Annotation")
                            {
                                Caracteristics_count = Caracteristics_count + 1;
                            }
                        }
                        
                        <tr>
                            <td rowspan="@va.variable_id.Count">@va.dataset_id</td>
                            <td rowspan="@va.variable_id.Count">Concept Coverage : @Concepts_count/@va.variable_id.Count <br /> Characteristics Coverage : @Caracteristics_count/@va.variable_id.Count</td>
                            <td>@va.variable_id[0] </td>
                            <td>@va.variable_label[0] </td>
                            <td>@va.variable_concept_entity[0] </td>
                            <td>@va.variable_concept_caracteristic[0] </td>
                            <td>@va.unit[0] </td>
                            <td>@va.dataType[0] </td>
                            
                        </tr>

                        for (int kk = 1; kk < @va.variable_id.Count; kk++)
                        {
                            <tr>
                                <td>@va.variable_id[kk] </td>
                                <td>@va.variable_label[kk] </td>
                                <td>@va.variable_concept_entity[kk] </td>
                                <td>@va.variable_concept_caracteristic[kk] </td>
                                <td>@va.unit[kk] </td>
                                <td>@va.dataType[kk] </td>
                            </tr>
                        }
                    }
                }
            }

        </tbody>
    </table>

</div>

<script type="text/javascript">

    function download() {
		$.ajax({
			url: '@Url.Action("Download_Report", "InteractiveSearch")',
			contentType: 'application/json; charset=utf-8',
			datatype: 'json',
			type: "GET",
			success: function (e) {

			    if (e) {
			        window.location = '@Url.Action("Download_Report", "InteractiveSearch")';
			    }
			    else {
			        alert("We can not generate file right now, report the error please");
			    }
                
			}
		})
	}
</script>